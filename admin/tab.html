<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <!--link href="lib/fonts/micons/material-design-icons.css" rel="stylesheet"-->
    <link rel="stylesheet" type="text/css" href="lib/css/vis.min.css">
    <link rel="stylesheet" type="text/css" href="lib/css/materialize.css">

    <script type="text/javascript" src="lib/js/vis.min.js"></script>
    <script type="text/javascript" src="lib/js/jquery-3.3.1.min.js"></script>
    <!--script type="text/javascript" src="../../lib/js/jquery-1.11.2.min.js"></script-->
    <script type="text/javascript" src="../../socket.io/socket.io.js"></script>
    <script type="text/javascript" src="../../lib/js/translate.js"></script>
    <script type="text/javascript" src="../../lib/js/loStorage.js"></script>
    <script type="text/javascript" src="lib/js/materialize.js"></script>
    <script type="text/javascript" src="lib/js/jquery.treetable.js"></script>
    <script type="text/javascript" src="lib/js/words.js"></script>

    <style type="text/css">
        @font-face {
            font-family: "Material Icons";
            font-style: normal;
            font-weight: 400;
            src: url("lib/fonts/MaterialIcons-Regular.woff2") format("woff2"),
            url("lib/fonts/MaterialIcons-Regular.woff") format("woff")
        }

        .material-icons {
            font-family: 'Material Icons';
            font-weight: 400;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            /* -webkit-font-feature-settings: 'liga'; */
            -webkit-font-smoothing: antialiased
        }

        button[disabled="disabled"] {
            pointer-events: none;
        }

        a[disabled="disabled"] {
            pointer-events: none;
        }

        .btn-small {
            height: 28px;
            line-height: 28px;
            padding: 0 4px;
            font-size: 15px;
        }

        .btn-small i {
            font-size: 20px;
            line-height: inherit;
        }

        .btn-floating.btn-small {
            width: 28px;
            height: 28px;
            line-height: 28px;
            padding: 0;
        }

        .w100 {
            width: 100%;
        }



        .chip>img {
            margin: 2px 8px 2px -12px;
            height: 28px;
            width: 28px;
        }

        .chips .input {
            width: 30% !important;
        }

        .clear,
        .clear-10,
        .clear-15 {
            clear: both;
            height: 0;
            overflow: hidden;
            /* Pr√©caution pour IE 7 */
        }

        .clear-10 {
            margin-bottom: 10px
        }

        .clear-15 {
            margin-bottom: 15px
        }

        .clear10 {
            margin-bottom: 10px
        }

        .clear15 {
            margin-bottom: 15px
        }

        .h3em {
            height: 3em
        }

        .h2em {
            height: 2em
        }

        .h4em {
            height: 4em
        }

        code {
            background-color: LemonChiffon;
            font-weight: 600;
            padding: 3px 3px;
        }

        img.help {
            margin: 2px 10px 2px -4px;
            height: 26px;
            width: 26px;
        }

        #log-data,
        #event-span {
            height: 43vh;
        }

        #mynetwork {
            width: 100%;
            height: 100%;
        }

        #tab-events-content,
        #log-data,
        #mynetwork {
            /* box-sizing: border-box; */
            /* position: relative; */
            /* width: 100%; */
            /* height: 50vh; */
            border: 2px solid lightgray;
        }

        #script-output {
            font-size: 0.9rem;
            padding: 0;
        }

        .card-header {
            font-size: 1.2rem;
            font-weight: 400;
        }

        table.treetable span.indenter {
            display: inline-block;
            margin: 0;
            padding: 0;
            text-align: right;
            /* Disable text selection of nodes (for better D&D UX) */
            user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -o-user-select: none;
            -webkit-user-select: none;
            /* Force content-box box model for indenter (Bootstrap compatibility) */
            -webkit-box-sizing: content-box;
            -moz-box-sizing: content-box;
            box-sizing: content-box;
            width: 24px;
        }

        #debugLevel.browser-default {
            height: 2.2em;
            font-size: 0.8rem;
        }

        textarea.input-output {
            font-family: 'DejaVu Sans Mono', monospace;
            font-size: 0.8rem;
        }

        table.treetable td,
        table.treetable th {
            padding: 4px 3px;
        }

        #script-output td {
            padding: 2px 2px;
        }

        /* .vis-item.green {
            background-color: Aquamarine;
            border-color: teal;
        }
 */

        h6 a {
            color: DarkSlateGray;
        }

        /*
        h6 a:active {
            color: DarkSlateGray;
        }

        h6 a:link {
            color: DarkSlateGray;
        }

        h6 a:visited {
            color: DarkSlateGray;
        }
*/

        h6 a:hover {
            color: teal;
        }

        td.ft {
            font-weight: 500;
            /* cursor: pointer; */
        }

        td.fd {
            font-size: 0.85rem;
        }

        td.ft.disabled {
            color: grey;
        }

        td.state-value {
            padding-right: 2em;
        }

        td a {
            color: inherit;
        }

        table.treetable span.indenter a {
            background-position: left center;
            background-repeat: no-repeat;
            display: inline-block;
            text-decoration: none;
            width: 24px;
        }


        table.treetable thead {
            background: #aaa url(data:image/png;base64,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) repeat-x top left;
            font-size: 1em;
        }

        table.treetable span.file {
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAQAAAC1+jfqAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAADoSURBVBgZBcExblNBGAbA2ceegTRBuIKOgiihSZNTcC5LUHAihNJR0kGKCDcYJY6D3/77MdOinTvzAgCw8ysThIvn/VojIyMjIyPP+bS1sUQIV2s95pBDDvmbP/mdkft83tpYguZq5Jh/OeaYh+yzy8hTHvNlaxNNczm+la9OTlar1UdA/+C2A4trRCnD3jS8BB1obq2Gk6GU6QbQAS4BUaYSQAf4bhhKKTFdAzrAOwAxEUAH+KEM01SY3gM6wBsEAQB0gJ+maZoC3gI6iPYaAIBJsiRmHU0AALOeFC3aK2cWAACUXe7+AwO0lc9eTHYTAAAAAElFTkSuQmCC);
        }

        table.treetable span.folder {
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAGrSURBVDjLxZO7ihRBFIa/6u0ZW7GHBUV0UQQTZzd3QdhMQxOfwMRXEANBMNQX0MzAzFAwEzHwARbNFDdwEd31Mj3X7a6uOr9BtzNjYjKBJ6nicP7v3KqcJFaxhBVtZUAK8OHlld2st7Xl3DJPVONP+zEUV4HqL5UDYHr5xvuQAjgl/Qs7TzvOOVAjxjlC+ePSwe6DfbVegLVuT4r14eTr6zvA8xSAoBLzx6pvj4l+DZIezuVkG9fY2H7YRQIMZIBwycmzH1/s3F8AapfIPNF3kQk7+kw9PWBy+IZOdg5Ug3mkAATy/t0usovzGeCUWTjCz0B+Sj0ekfdvkZ3abBv+U4GaCtJ1iEm6ANQJ6fEzrG/engcKw/wXQvEKxSEKQxRGKE7Izt+DSiwBJMUSm71rguMYhQKrBygOIRStf4TiFFRBvbRGKiQLWP29yRSHKBTtfdBmHs0BUpgvtgF4yRFR+NUKi0XZcYjCeCG2smkzLAHkbRBmP0/Uk26O5YnUActBp1GsAI+S5nRJJJal5K1aAMrq0d6Tm9uI6zjyf75dAe6tx/SsWeD//o2/Ab6IH3/h25pOAAAAAElFTkSuQmCC);
        }

        table.treetable tr.collapsed span.indenter a {
            background-image: url(data:image/png;base64,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);
        }

        table.treetable tr.expanded span.indenter a {
            background-image: url(data:image/png;base64,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);
        }

        table.treetable tr span.indenter a {
            outline: none;
            /* Expander shows outline after upgrading to 3.0 (#141) */
        }

        table.treetable tr.collapsed.selected span.indenter a {
            background-image: url(data:image/png;base64,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);
        }

        table.treetable tr.expanded.selected span.indenter a {
            background-image: url(data:image/png;base64,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);
        }

        table.treetable tr.accept {
            background-color: #a3bce4;
            color: #fff
        }

        #tree tbody {
            display: block;
            height: 45vh;
            overflow: auto;
        }

        .no-padding {
            padding: 0 0 0 0;
        }

        #tree thead,
        #tree tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        #tree thead {
            width: calc( 100% - 1em);
        }

        #tree {
            width: 100%;
        }

        table.treetable tr.collapsed.accept td span.indenter a {
            background-image: url(data:image/x-png;base64,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);
        }

        table.treetable tr.expanded.accept td span.indenter a {
            background-image: url(data:image/x-png;base64,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);
        }
    </style>

    <script type="text/javascript">
        //--------------------------------------------------------- COMMONS -----------------------------------------------------------------------
        /** 
         * Translate word
         * @param {type} word
         * @returns {String}
         */

        function _(word) {
            var text = translateWord(word, systemLang, systemDictionary);

            for (var i = 1; i < arguments.length; i++) {
                var pos = text.indexOf('%s');
                if (pos !== -1) {
                    text = text.replace('%s', arguments[i]);
                }
            }

            return text;
        }

        function oToString(s) {
            return JSON.stringify(s, null, 0).replace(/([\{\,\[])\"([A-Z_$]\w*)":/gi, (match, p1, p2) => ' ' + p1 + p2 +
                ': ')
        }

        function ownKeys(obj) {
            return typeof obj === 'object' ? Object.keys(obj).filter(function (k) {
                return obj.hasOwnProperty(k);
            }) : [];
        }

        function ownKeysSorted(obj) {
            return ownKeys(obj).sort(function (a, b) {
                a = a.toLowerCase();
                b = b.toLowerCase();
                if (a == b) return 0;
                if (a > b) return 1;
                return -1;
            });
        }

        function getTimeString(time) {
            const tzoffset = (new Date()).getTimezoneOffset() * 60000; //offset in milliseconds
            return (new Date(+time - tzoffset)).toISOString().slice(11, -1);
        }

        function cloneObject(obj) {
            return !!obj ? JSON.parse(JSON.stringify(obj)) : obj;
        }


        function newClick(sel, fun) {
            return offOn(sel, 'click', fun);
        }

        function addEvent(obj, type) {
            if (workTree && workTree.debugLevel > 1)
                setTimeout(main.onLog, 10, {
                    severity: 'intern',
                    ts: Date.now(),
                    message: type + ': ' + JSON.stringify(obj, null, ' ')
                });
        }

        const REGEXP = 'regexp',
            IDNAME = 'id',
            SCHEDULE = 'schedule',
            EVERY = 'every',
            DELAY = 'delay',
            EXEC = 'exec',
            EVAL = 'eval',
            STATE = 'state',
            UNKNOWN = 'unknown',
            MACHINE = 'machine',
            SCENE = 'scene',
            EVENT = 'event',
            ASTRO = 'astro',
            LINK = 'link',
            TIMER = 'timer',
            FOLDER = 'folder',

            F_id = ' id',
            F_default = ' default',
            F_expanded = ' expanded',
            F_type = ' type',
            F_disabled = ' disabled',
            F_timeout = ' timeout',
            F_fire = ' fire',
            F_onFire = ' onfire',
            F_onEnter = ' onenter',
            F_onExit = ' onexit',
            F_function = ' function',
            F_active = ' active',

            I_Folder = 'folder',
            I_FolderAd = 'create_new_folder',
            I_Machine = 'settings',
            I_MachineAdd = 'settings_applications',
            I_Link = 'insert_link',
            I_State = 'location_searching',
            I_StateAdd = 'my_location',
            I_Timer = 'timer',
            I_Timeout = 'timer_off',
            I_Event = 'flash_on',
            I_EventAdd = 'flash_auto',
            I_LinkAuto = 'star_border',
            I_Rename = 'edit',
            I_Delete = 'delete',
            I_Scene = 'list',
            ticons = {
                [MACHINE]: I_Machine,
                [STATE]: I_State,
                [LINK]: I_Link,
                [SCENE]: I_Scene,
                [EVENT]: I_Event,
                [FOLDER]: I_Folder,
                [TIMER]: I_Timer,
                Folder: I_Folder,
                FolderAd: I_FolderAd,
                Machine: I_Machine,
                MachineAdd: I_MachineAdd,
                Link: I_Link,
                State: I_State,
                StateAdd: I_StateAdd,
                Timer: I_Timer,
                Timeout: I_Timeout,
                Event: I_Event,
                EventAdd: I_EventAdd,
                LinkAuto: I_LinkAuto,
                Rename: I_Rename,
                Delete: I_Delete,
                Scene: I_Scene
            },

            regStateName = /^[$_A-Za-z][\-$\w]{1,19}$/,
            regTimerName = /^(\d+h)?\s*(\d+m(?!s))?\s*(\d+s?)?\s*(\d+ms)?\s*$/i,
            regMachineName = /^[$_A-Za-z][\-$\w]{2,19}$/,
            autoLink = "*",
            debugLevel = '._debugLevel',
            stateDisabled = '._disabled',
            adapterName = 'statemachine',
            adapterNameDot = adapterName + '.',


            regIdAction = /^\s*([^\/\!\&\=\~]+)(&\s*)?(!\s*)?(\/\s*)?(\~\s*|\=\+\s*|\=\-\s*|\=\!\s*|\=\?\s*|\=.+|\s*)$/,
            regEval = /^\s*(\(.+\))\s*$/,
            regExec = /^\s*\$\s*(.+)$/,
            regAstro = /^\s*@\s*([A-Z]+)\s*([\+\-]\d+)?\s*$/i,
            regDelay = /^\s*(\d+m)?\s*(\d+s)?\s*(\d+(?:ms)?)?\s*$/,
            regTimer = /^\s*(\d+h)?\s*(\d+m(?!s))?\s*(\d+s?)?\s*(\d+ms)?\s*$/i,
            regEvery = /^\s*(\d+w)?\s*(\d+d)?\s*(\d+h)?\s*(\d+m)?\s*(\d+s?)?$/i,
            regTime = /^\s*([\d\-\*\,\/]+)\s*:\s*([\d\-\*\,\/]+)\s*(?::\s*([\d\-\*\,\/]+))?$/i,
            regSchedule =
            /^\s*((?:[0-9]?\d|\*)(?:(?:[\/-][0-9]?\d)|(?:,[0-9]?\d)+)?\s*){5}((?:[0-9]?\d|\*)(?:(?:[\/-][0-9]?\d)|(?:,[0-9]?\d)+)?)?$/,
            regId =
            /^\s*([^@][^\?\&\!\~\><\=\^\$#]+)([\?\&\!]?)\s*(~?)\s*(\+(?=\s*$)|\-(?=\s*$)|\=|\!=|>\=|>|<\=|<|\?|\^|\$|\#|$)\s*(.*)$/,
            regRegexp =
            /^\s*(\/.+\/i?)\s*([\?\&\!]?)\s*(~?)\s*(\+(?=\s*$)|\-(?=\s*$)|\=|\!=|>\=|>|<\=|<|\?|\^|\$|\#|$)\s*(.*)$/;

        var that = this,
            main = {
                firstConnect: true,
                objects: {},
                states: {},
                mstate: {},
                sstate: {},
                icons: {},
                svalues: {},
                history: {},
                currentId: null,
                currentHost: '',
                hosts: [],
                instances: [],
                that: this,
                changed: false,
                objectsLoaded: false,
                waitForRestart: false,
                connectCb: null,
                changed: false,
                socket: io.connect(),
                systemLang: 'en',
                adapterConfig: {},
                //            adapterConfigId: 'system.adapter.statemachine.0',
                adapterConfigId: adapterNameDot + 'config',
                adapterConfigIds: [],
                instance: 0,
                instanceName: function (dot) {
                    var n = adapterNameDot + main.instance;
                    if (dot) {
                        if (typeof dot === 'string') {
                            if (dot.startsWith(adapterNameDot + main.instance + '.'))
                                return dot;
                            n += '.' + dot;
                        } else n += '.';
                    }
                    return n;
                },
                //            socket: io.connect(location.protocol + '//' + location.host, {
                //                query: 'ws=true'
                //            }),
                saveConfig: function () {
                    if (checkMachines())
                        return;
                    main.adapterConfig = createConfig();
                    var cconf = main.objects[main.adapterConfigId];
                    cconf.native = main.adapterConfig;
                    //                main.objectChange(main.adapterConfigId, cconf);
                    main.socket.emit('setObject', main.adapterConfigId, cconf, function (err) {
                        if (err) {
                            showError(err);
                            //                        that.init(true);
                        }
                    });
                    main.oldconfig = createConfig(true);
                    main.changed = false;
                    showMessage('Saved Adapter config which restarted the machines!');
                },
                setState: function (id, val) {
                    if (!id.startsWith(main.currentId + '.'))
                        id = main.currentId + '.' + id;
                    main.socket.emit('setState', id, val, function (err) {
                        if (err) {
                            showError(err);
                        }
                    });
                },
                addSState: function addSState(obj, id) {
                    if (obj.type === STATE && !id.startsWith('system.adapter.')) {
                        var n = obj.common.name;
                        //                    var i = {id: id, icon: main.icons['system.adapter.'+split]};
                        if (!main.mstate[n]) {
                            if (main.sstate[n]) {
                                main.sstate[id] = id;
                                main.mstate[n] = [id];
                                delete main.sstate[n];
                            } else
                                main.sstate[n] = id;
                        } else {
                            main.mstate[n].push(id);
                            main.sstate[id] = id;
                        }
                    }

                },
                objectChange: function (id, obj) {
                    if (obj) {
                        if (obj._rev && main.objects[id]) main.objects[id]._rev = obj._rev;
                        if (!main.objects[id] || JSON.stringify(main.objects[id]) != JSON.stringify(obj)) {
                            main.objects[id] = obj;
                        }
                    } else if (main.objects[id]) {
                        var oldObj = {
                            _id: id,
                            type: main.objects[id].type
                        };
                        delete main.objects[id];
                        if (id.match(/^system\.adapter\.[-\w]+\.[0-9]+$/)) { /// TODO
                            // Disable statemachine tab if no one script engine instance found
                            //                    var engines = main.fillEngines();
                            //                    $('#tabs').tabs('option', 'disabled', (engines && engines.length) ? [] : [4]);
                        }
                    }
                    if (id.startsWith(adapterNameDot))
                        addEvent(obj, `Object Change:${id}`);
                },
                addHistory: function (id, state) {
                    var h = main.history[id] ? main.history[id] : (main.history[id] = {});
                    h[state.ts] = {
                        ts: new Date(parseInt(state.ts)),
                        val: state.val,
                        ack: state.ack,
                        from: state.from
                    };
                    var lname = id.slice(main.instanceName(true).length);
                    if (idList[lname] && idList[lname][F_type] === MACHINE) {
                        var mach = idList[lname];
                        var oldst = mach[F_active];
                        var nst = mach[F_active] = getValue(lname);
                        var oid = lname + '.' + oldst;
                        var nid = lname + '.' + nst;
                        if (ndata && ndata.nodes) {
                            var on = ndata.nodes.get(oldst);
                            if (on) {
                                on.shapeProperties = {
                                    borderDashes: true
                                };
                                ndata.nodes.update(on);
                            }
                            var on = ndata.nodes.get(nst);
                            if (on) {
                                on.shapeProperties = {
                                    borderDashes: false
                                };
                                ndata.nodes.update(on);
                            }
                        }
                        $('#table-data').find('[data-tt-id="' + oid + '"]').find('td.id-field').removeClass(
                            'lighten-4').removeClass('teal');
                        $('#table-data').find('[data-tt-id="' + nid + '"]').find('td.id-field').addClass('teal').addClass(
                            'lighten-4');
                    }
                    addVal(h[state.ts], lname, false);
                },
                getHistory: function (id) {
                    var h = main.history[id];
                    if (!h)
                        h = main.history[main.instanceName(id)];
                    if (!h)
                        return [];
                    var r = [];
                    for (var i of ownKeys(h))
                        r.push(h[i]);
                    return r;
                },
                stateChange: function (id, state) {
                    var os = cloneObject(main.states[id] || {});
                    var s = {
                        ostate: os,
                        nstate: cloneObject(state),
                    };
                    main.states[id] = state;
                    if (id.startsWith(main.instanceName(true))) {
                        for (var k of ownKeys(state))
                            if (k == 'ts' || s.ostate[k] == s.nstate[k]) {
                                delete s.nstate[k];
                                delete s.ostate[k];
                            }
                        // state.lc = 
                        s.nstate.lc = s.ostate.ts;
                        if (JSON.stringify(s.ostate) != JSON.stringify(s.nstate)) {
                            // console.log(id + ': ' + oToString(s));
                            if (id == main.currentId + debugLevel)
                                setDebug(state.val, false);
                            if (main.svalues[id]) {
                                $(`span[s-v="${id}"`).html(getValue(id, true));
                                /// TODO: check machine states to display them!
                                main.addHistory(id, state);
                            }
                        }
                    }
                    //id = id ? id.replace(/[\s'"]/g, '_') : ''; /// TODO - do not know what it does!
                    //if (!id || !id.match(/\.messagebox$/)) {
                    //}
                },
                getStates: function (callback) {
                    main.socket.emit('getStates', function (err, res) {
                        main.states = res;
                        if (typeof callback === 'function')
                            setTimeout(callback, 0);
                    });
                },
                getObjects: function (callback) {
                    main.socket.emit('getAllObjects', function (err, res) {
                        setTimeout(function () {
                            var obj;
                            main.objects = res;
                            for (var id in main.objects) {
                                if (id.slice(0, 7) === '_design') continue;

                                obj = res[id];
                                main.addSState(obj, id);
                                var an = obj._id.split('.')[2];
                                if (obj.common && obj.common.icon)
                                    main.icons[id] = '/adapter/' + id.split('.')[0] + obj.common.icon;
                                if (an && obj.type == "adapter") {
                                    main.icons[an] = '/adapter/' + an + '/' + obj.common.icon;
                                }
                                if (obj.type === 'instance') {
                                    main.instances.push(id);
                                    if (id.startsWith('system.adapter.' + adapterNameDot))
                                        main.adapterConfigIds.push(id.slice(15));
                                }
                                //                        if (obj.type === 'channel' && id.match(/^script\.js\./)) main.groups.push(id);
                                if (obj.type === 'host') main.hosts.push(id);
                            }
                            main.objectsLoaded = true;
                            if (main.adapterConfigIds.length > 0) {
                                main.adapterConfigId = 'system.adapter.' + main.adapterConfigIds[0];
                                main.currentId = main.adapterConfigIds[0];
                            }
                            if (typeof callback === 'function') callback();
                        }, 0);
                    });
                },

                onLog: function (message) {
                    //                    addEvent(message, ' On Log:');
                    if (!main.$parentOutput) main.$parentOutput = $('#script-output').parent().parent();

                    //{"message":"javascript.0 Stop script script.js.Script4","severity":"info","from":"javascript.0","ts":1455490697111,"_id":364}
                    if (message.message.indexOf(adapterNameDot) !== -1 || message.severity === 'intern') {
                        const color = {
                            debug: "blue lighten-4",
                            error: "red lighten-4",
                            warn: "orange lighten-4",
                            info: "white",
                            intern: "green lighten-4"
                        }
                        var text = '<tr class="' + color[message.severity] + '"><td>' + getTimeString(new Date(
                                message.ts)) +
                            '</td><td>[' + message.severity + ']</td><td>' + message.message + '</td></tr>';
                        var h = main.$parentOutput.height();

                        var oldHeight = $('#script-output').height();
                        var scrollTop = main.$parentOutput.scrollTop();
                        var shiftToEnd = (scrollTop + h >= oldHeight - 5);

                        if (oldHeight > 2000) {
                            $('#script-output tr:first').remove();
                            var oldHeight1 = $('#script-output').height();
                            main.$parentOutput.scrollTop(scrollTop - (oldHeight - oldHeight1));

                            oldHeight = oldHeight1;
                        }

                        var scrollTop = main.$parentOutput.scrollTop();
                        var shiftToEnd = (scrollTop + h >= oldHeight - 5);

                        $('#script-output').append(text);

                        if (shiftToEnd) {
                            main.$parentOutput.scrollTop(oldHeight + 50);
                        }
                    }
                },

                /** 
                 * Read the settings for adapter
                 * @param {type} callback
                 */
                readInstanceConfig: function (callback) {
                    main.systemConfig = main.objects['system.config'];
                    //                    addEvent(main.systemConfig, "System Config");
                    if (main.systemConfig && main.systemConfig.common) {
                        main.systemLang = main.systemConfig.common.language;
                    } else {
                        main.systemLang = window.navigator.userLanguage || window.navigator.language;

                        //                    if (main.systemLang !== 'en' && main.systemLang !== 'de' && main.systemLang !== 'ru') {
                        //                        main.systemConfig.common.language = 'en';
                        //                        main.systemLang = 'en';
                        //                    }
                    }
                    main.adapterConfig = main.objects[main.adapterConfigId];
                    if (main.adapterConfig && main.adapterConfig.native)
                        main.adapterConfig = main.adapterConfig.native;
                    else
                        main.adapterConfig = null;

                    // addEvent({
                    // adapterConfig: main.adapterConfig,
                    // language: systemLang,
                    // states: ownKeys(main.states).length,
                    // objects: ownKeys(main.objects).length,
                    // hosts: ownKeys(main.hosts).length,
                    // mstates: ownKeys(main.mstate).length,
                    // sstates: ownKeys(main.sstate).length,
                    // }, "Adapter Config")
                    if (typeof callback === 'function') {
                        callback();
                    }
                },
                init: function (callb) {
                    if (callb)
                        main.connectCb = callb;
                    main.socket.removeAllListeners('permissionError');
                    main.socket.removeAllListeners('objectChange');
                    main.socket.removeAllListeners('onUpdate');
                    main.socket.removeAllListeners('stateChange');
                    main.socket.removeAllListeners('connect');
                    main.socket.removeAllListeners('disconnect');
                    main.socket.removeAllListeners('reconnect');
                    main.socket.removeAllListeners('reauthenticate');
                    main.socket.removeAllListeners('log');

                    main.socket.on('permissionError', function (err) {
                        showMessage(_('Has no permission to %s %s %s', err.operation, err.type, (
                            err.id ||
                            '')));
                    });
                    main.socket.on('objectChange', function (id, obj) {
                        setTimeout(main.objectChange, 0, id, obj);
                    });
                    main.socket.on('onUpdate', function (id, obj) {
                        setTimeout(main.stateChange, 0, id, obj);
                    });
                    main.socket.on('stateChange', function (id, obj) {
                        setTimeout(main.stateChange, 0, id, obj);
                    });
                    main.socket.on('connect', function () {
                        $('#connecting').hide();
                        if (main.firstConnect) {
                            main.firstConnect = false;

                            main.socket.emit('getUserPermissions', function (err, acl) {
                                main.acl = acl;
                                // Read system configuration
                                main.socket.emit('getObject', 'system.config', function (
                                    err, data) {
                                    main.systemConfig = data;
                                    if (!err && main.systemConfig && main.systemConfig
                                        .common) {
                                        systemLang = main.systemConfig.common.language;
                                    } else {
                                        systemLang = window.navigator.userLanguage ||
                                            window.navigator.language;

                                        if (systemLang !== 'en' && systemLang !==
                                            'de' &&
                                            systemLang !==
                                            'ru') {
                                            main.systemConfig.common.language =
                                                'en';
                                            systemLang = 'en';
                                        }
                                    }

                                    translateAll();

                                    main.getStates(function () {
                                        main.getObjects(function () {
                                            main.readInstanceConfig(
                                                function () {
                                                    if (main.connectCb)
                                                        main.connectCb();
                                                })
                                        })
                                    });
                                });
                            });
                        }
                        if (main.waitForRestart) {
                            location.reload();
                        }
                    });
                    main.socket.on('disconnect', function () {
                        $('#connecting').show();
                    });
                    main.socket.on('reconnect', function () {
                        $('#connecting').hide();
                        if (main.waitForRestart) {
                            location.reload();
                        }
                    });
                    main.socket.on('reauthenticate', function () {
                        location.reload();
                    });
                    main.socket.on('log', function (message) {
                        setTimeout(main.onLog, 1, message);
                    });

                }
            };

        var modalOpts = {
            dismissible: true, // Modal can be dismissed by clicking outside of the modal
            opacity: .5, // Opacity of modal background
            inDuration: 100, // Transition in duration
            outDuration: 100, // Transition out duration
            startingTop: '5%', // Starting top style attribute
            endingTop: '10%', // Ending top style attribute
            ready: function (modal) {
                var f = modal.find('.input-modal-field');
                if (f.first() && f.first()[0] && f.first()[0].nodeName == 'DIV')
                    f = f.find('.select-dropdown');
                f.focus();
            },

            complete: function modalComplete($m) {
                if (!$m) return;
                var fun = $m.data('callback');
                if (typeof fun == 'function')
                    fun($m.data('OK'));
            },
        };

        function createToast(string, icon, time) {
            var $toastContent = $((icon ? '<i class="medium material-icons">' + icon + '</i>&nbsp;&nbsp;' : '') +
                '<span><b>' + string + '</b></span>')
            //                .add($('<button class="btn-flat toast-action">OK</button>'))
            ;
            Materialize.toast($toastContent, time || icon == "error" ? 5000 : 3000, (icon == 'error' ?
                'red darken-4' :
                'blue darken-4') + ' rounded');
        }

        function showError(string) {
            createToast(string, 'error');
        }

        function showMessage(string) {
            createToast(string, 'announcement');
        }

        function enableDisable(sel, value) { //value = true = enabled
            if (Array.isArray(sel))
                return sel.forEach(function (id) {
                    enableDisable(id, value);
                })
            return makeSel(sel).toggleClass('disabled', !value);
        }

        function getValue(id, html, s1) {
            var s = main.states[id];
            if (!s) {
                id = main.instanceName(id);
                s = main.states[id];
            }
            if (!s)
                return null;
            if (s1) s = s1;
            main.svalues[id] = true;
            var t = '' + s.val;
            var c = main.objects[id].common;
            if (c) {
                if (c.states && c.type == 'number')
                    c.states.split(';').forEach(function (i) {
                        var ss = i.split(':');
                        if (ss[0] == s.val)
                            t = ss[1];
                    });
                if (c.unit && c.type == 'number')
                    t += ' ' + c.unit;
            }
            if (html) {
                var newSpan = document.createElement('span');
                newSpan.innerText = t;
                var escaped = newSpan.innerHTML.replace(/"/g, '&quot;');
                if (t.length > 50)
                    t =
                    `<a href="#!" title="${escaped}">${newSpan.innerHTML.slice(0,30).replace(/"/g, '&quot;') + '...'}</a>`;
                else
                    t = escaped;

            }
            return t;
        }

        function showInputModal(o, fun) {
            if (typeof fun != 'function')
                fun = null;

            function ix(t, i) {
                return $('#input-modal-' + t + i);
            }
            var $t = $('#input-modal');
            $t.find('select').material_select('destroy');
            if (typeof o === 'string') {
                var a = o.split('|');
                o = {};
                o.title = a[0];
                o.text = a[1];
                o.button = a[2];
                o.flds = a.slice(3);
            }
            $('#input-modal-title').text(o.title || "Please enter");
            $('#input-modal-text').text(o.text || "");
            $('#input-modal-button').text(o.button || "OK");
            if (typeof o.flds === 'string')
                o.flds = [o.flds.split('|')]
            else if (!Array.isArray(o.flds) && typeof o.flds == 'object')
                o.flds = [
                    [o.flds.name, o.flds.icon, o.flds.value]
                ]
            else if (Array.isArray(o.flds) && !Array.isArray(o.flds[0]))
                o.flds = [o.flds];
            else if (!Array.isArray(o.flds))
                o.flds = [
                    ["Name", 'create', '']
                ];
            var html = '';
            for (var i = 0; i < 3 && i < o.flds.length; i++) {
                var ii = o.flds[i];
                var ip = '' + (i + 1);
                if (typeof ii[2] === 'string')
                    html +=
                    `<div class=" row"><div class="col s2"><i class="material-icons prefix right">${ii[1]}</i></div><div class="col s10">
                            <input type="text" placeholder=" " class="input-modal-field" id="input-modal-field${ip}" value="${ii[2]}"><label for="input-modal-field${ip}" class="active">${ii[0]}</label>
                                </div></div>`;
                else if (Array.isArray(ii[2])) {
                    var h =
                        `<div class=" row"><div class="col s2"><i class="material-icons prefix right">${ii[1]}</i></div><div class="input-field col s10">
                        <select id="input-modal-field${ip}" class="input-modal-field" ><option value="" disabled selected>Choose your option</option>`;
                    for (var ij of ii[2])
                        h += `<option value="${ij}">${ij}</option>`;
                    html += h + `</select><label>${ii[0]}</label></div></div>`;
                }
            }
            html = $('#input-modal-inputs').html(html);
            newClick('#input-modal-button', function (event) {
                $('#input-modal').data('OK', [$('#input-modal-field1').val(), $('#input-modal-field2').val(),
                    $('#input-modal-field3').val()
                ]);
            });


            html.find('select').material_select();
            $t.data('callback', o.callback || fun);
            $t.data('OK', null);
            $t.modal('open');
        }

        function confirmMessage(message, title, icon, buttons, callback) {
            function disEn(sel, val) {
                if (sel && sel[0]) {
                    switch (sel[0].nodeName) {
                        case 'BUTTON':
                            enableDisable(sel, val);
                            break;
                        case 'DIV':
                            if (val)
                                sel.show();
                            else
                                sel.hide();
                            break;
                        default:
                            break;
                    }
                }
            }

            function enableDisableChange(sel, text, icon) { //value = true = enabled
                sel = makeSel(sel);
                var ch = sel.children();
                var t = sel.data('mytype');
                if (!text)
                    text = '';
                if (t) {
                    sel.removeClass(t);
                    sel.data('mytype', null);
                }
                if (text) {
                    var m = text.match(/^\s*\(([\w\s*]+)\)\s*(.*)\s*$/);
                    if (m) {
                        sel.data('mytype', m[1])
                        sel.addClass(m[1]);
                        text = m[2];
                    }
                    disEn(sel, true);
                    if (ch.length > 1)
                        ch[1].innerHTML = text;
                }
                if (icon && ch.length > 0)
                    ch[0].innerHTML = icon;
                disEn(sel, text || icon);
            }

            if (typeof icon == 'function') {
                callback = icon;
                icon = undefined,
                    buttons = 2;
            } else if (typeof buttons == 'function') {
                callback = buttons;
                buttons = 2;
            }

            var t = $('#modalText').children();
            t[0].innerHTML = title || "Information";
            t[1].innerHTML = message || ' ';
            buttons = buttons || 1;
            if (typeof buttons === 'string')
                buttons = buttons.split(',');
            else if (!Array.isArray(buttons)) {
                buttons = buttons == 1 ? ['OK'] : ['OK', 'cancel'];
            }
            $('#modalIcon').text(icon || buttons.length > 1 ? 'help' : "info");
            enableDisableChange('#modalOk', buttons[0])
            if (buttons.length == 1)
                $('#modalExit').hide();
            else {
                enableDisableChange('#modalExit', buttons[1])
                $('#modalExit').show();
            }
            $('#dialog-modal').data('callback', callback);
            $('#dialog-modal').data('OK', false);
            $('#dialog-modal').modal('open');
        }



        function createConfig(comp) {
            if (!comp)
                return cloneObject(workTree);
            var all = {};
            all.debugLevel = parseInt(workTree.debugLevel);
            all.queueTime = parseInt(workTree.queueTime);
            all.queueAll = !!workTree.queueAll;
            all.folders = cloneObject(workTree.folders);
            return JSON.stringify(all);
        }

        function checkConfig() {
            if (oldconf)
                clearTimeout(oldconf);
            oldconf = setTimeout(function () {
                var now = createConfig(true);
                oldconf = null;
                if (!main.oldconfig)
                    main.oldconfig = now;
                main.changed = (main.oldconfig != now);
                enableDisable(['#saveButton', '#reloadButton'], main.changed);
            }, 100);

        }

        var curMachine, curState, curEdge, curVar, curFolder = '',
            $table, $debugLevel, curId, curPar, curChip, curScene, oldconf,
            curEvent, fromNode, idList = {},
            workTree, nameData, wi = [];

        function setDebug(level, store) {
            level = parseInt(level);
            $('#debugLevel').val(workTree.debugLevel = level);
            if (store) main.setState(main.currentId + debugLevel, level)
            checkConfig();
        }

        function pageInit(cb) {
            main.init(function () {
                //                options.locale = main.systemLang;
                //            alert('Selection length:' + $("#node-popUp").length + ', ' + $("#nodepopUp").length+ ', ' + $("#nodePopUp").length)
                workTree = cloneObject(main.adapterConfig);
                if (cb && typeof cb === 'function')
                    cb();
            });

            window.onbeforeunload = function (evt) {
                if (main.changed) {
                    if (window.confirm(_('Script changes are not saved. Discard?'))) {
                        return null;
                    } else {
                        return _('Configuration not saved.');
                    }
                }
                return null;
            };

            $table = $("#tree");

            $('i[my-icon]').each(function (e) {
                $(this).text(ticons[$(this).attr('my-icon')]);
            });

            $('#dialog-modal').modal(modalOpts);
            $('#input-modal').modal(modalOpts);
            newClick('#modalOk', function (event) {
                $('#dialog-modal').data('OK', true);
            });
            enableDisable('button.ok-cancel', false);
            $debugLevel = $('#debugLevel').unbind('change').change(function () {
                setDebug($(this).val(), true);
            });
            $('#tab-events-content').show();
            offOn('#importButton', 'mousedown', function (evt) {
                evt.preventDefault();
                $('#fileJsonInput').click();
                return false;
            });
            offOn('#fileJsonInput', 'change', function (evt) {
                evt.preventDefault();
                if (evt.target.files.length <= 0)
                    return false;
                var reader = new FileReader();
                reader.onerror = function (evt) {
                    switch (evt.target.error.code) {
                        case evt.target.error.NOT_FOUND_ERR:
                            alert('File Not Found!');
                            break;
                        case evt.target.error.NOT_READABLE_ERR:
                            alert('File is not readable');
                            break;
                        case evt.target.error.ABORT_ERR:
                            alert('File read cancelled');
                            break; // noop
                        default:
                            alert('An error occurred reading this file.');
                    };
                };
                reader.onloadend = function (evt) {
                    if (evt.target.readyState == FileReader.DONE)
                        try {
                            var nc = JSON.parse(evt.target.result);
                            confirmMessage('Do you really want to import and loose any changes?',
                                'Import config', 'alert', ok => {
                                    if (ok) {
                                        // addEvent(nc, 'Import File');
                                        workTree = nc;
                                        setTimeout(createFolderTree, 1);
                                        checkConfig();
                                    }
                                });
                        } catch (e) {
                            return showError('JSON file error! ' + e)
                        }
                };
                reader.readAsText(evt.target.files[0]);
                evt.target.value = "";
                // TODO: refresh table
                return false;
            });
            newClick('#exportButton', function (e) {
                e.preventDefault();
                var s = createConfig();
                if (checkMachines())
                    return;
                s.saved = (new Date()).toString();
                s = JSON.stringify(s, undefined, 2);
                var fileName = adapterNameDot + 'json';
                if (window.navigator.msSaveOrOpenBlob) {
                    var blobObject = new Blob([s]);
                    window.navigator.msSaveOrOpenBlob(blobObject, fileName);
                } else {
                    var url = "data:text/javascript;charset=utf-8," + encodeURIComponent(s);
                    var link = document.createElement('a');
                    document.body.appendChild(link);
                    $(link).attr("download", fileName).attr("href", url).text('download');
                    link.click();
                    $('body').children('a').last().remove();
                }
                return false;
            });
            newClick('#saveButton', main.saveConfig);
            newClick('#reloadButton', function (event) {
                confirmMessage('Do you really want to reaload before saving any changes?',
                    'Reload config', 'alert',
                    function (ok) {
                        if (ok) {
                            main.changed = false;
                            window.location.reload();
                        }
                    });
            });
            $('select').material_select();
            offOn('input.mach-val', 'input', function (e) {
                var $t = $(this);
                var v = validateInput($t);
                var vid = $('#input-folder').val();
                if (this.id != 'input-folder')
                    vid = (vid ? vid + '.' : '') + $t.val();
                if (idList[vid])
                    $t.toggleClass('invalid', !(v = false));
                enableDisable($t.closest('div').find('a'), v);
                //                e.target.checkValidity();
                // addEvent({
                // val: v,
                // v: $t.val(),
                // vid: vid
                // }, 'input ' + $t[0].toString());
            });
            offOn('#input-name-folder', 'input', function () {
                validateInput($(this));
                enableDisable('#input-rename-folder', curFolder != $(this).val());
            });
            offOn('#input-name-machine', 'input', function () {
                validateInput($(this));
                enableDisable('#input-rename-machine', curMachine != $(this).val());
            });
            offOn('#input-name-event', 'input', function () {
                validateInput($(this));
                enableDisable('#input-rename-event', curEvent != $(this).val());
            });
            offOn('#input-name-scene', 'input', function () {
                validateInput($(this));
                enableDisable('#input-rename-scene', curScene != $(this).val());
            });
            $('div.input-table').hide();
            newClick('#folder-add', function (e) {
                var ok = $('#input-folder').val();
                if (ok) {
                    if (!regMachineName.test(ok))
                        showMessage('invalid name, please change $-_A-Za-z0-9 3-20 chars!');
                    else if (idList[ok])
                        showMessage('Name already used, please change!');
                    else {
                        addId(ok, null, I_Folder, workTree.folders[ok] = {});
                        regenSelect(ok);
                    }
                }
            });
            newClick('#scene-add', function (e) {
                var ok = $('#input-scene').val();
                curFolder = $('#input-folder').val();
                if (curFolder && (!idList[curFolder] || idList[curFolder][F_type] != 'folder'))
                    return showMessage(`Folder '${curFolder}' not existing!`);
                var vid = curFolder ? curFolder + '.' + ok : ok;
                var f = curFolder ? idList[curFolder] : workTree.folders[''];
                if (!regMachineName.test(ok))
                    showMessage('invalid name, please change $-_A-Za-z0-9 3-20 chars!');
                else if (idList[vid])
                    showMessage('Name already used, please change!');
                else {
                    addId(ok, curFolder, I_Scene, f[ok] = {});
                    regenSelect(vid);
                }
            });
            newClick('#event-add', function (e) {
                var ok = $('#input-event').val();
                curFolder = $('#input-folder').val();
                if (curFolder && (!idList[curFolder] || idList[curFolder][F_type] != 'folder'))
                    return showMessage(`Folder '${curFolder}' not existing!`);
                var vid = curFolder ? curFolder + '.' + ok : ok;
                var f = curFolder ? idList[curFolder] : workTree.folders[''];
                if (!regMachineName.test(ok))
                    showMessage('invalid name, please change $-_A-Za-z0-9 3-20 chars!');
                else if (idList[vid])
                    showMessage('Name already used, please change!');
                else {
                    addId(ok, curFolder, I_Event, f[ok] = {});
                    regenSelect(vid);
                }
            });
            newClick('#machine-add', function (e) {
                var m = $('#input-machine').val();
                curFolder = $('#input-folder').val();
                if (curFolder && (!idList[curFolder] || idList[curFolder][F_type] != 'folder'))
                    return showMessage(`Folder '${curFolder}' not existing!`);
                var vid = curFolder ? curFolder + '.' + m : m;
                var f = curFolder ? idList[curFolder] : workTree.folders[''];
                if (!regMachineName.test(m))
                    showMessage('invalid name, please change $-_A-Za-z0-9 3-20 chars!');
                else if (idList[vid])
                    showMessage('Name already used, please change!');
                else {
                    var nm = f[m] = {};
                    addId(m, curFolder, I_Machine, nm);
                    nm.Off = {};
                    addId('Off', vid, I_State, nm.Off);
                    regenSelect(vid);
                }
            });
            newClick('a.input-remove',
                () => setTimeout(function () {
                    var id = curId;
                    var par = curPar;
                    s = idList[par];
                    if (s && s[F_type] == MACHINE) {
                        if (getStates(s).length < 2)
                            return showError(`cannot delete last state/timer of machine!`)
                    }

                    confirmMessage(`do you really want to delete '${id}'?`, 'Delete ' + id,
                        function (ok) {
                            if (ok) {
                                $table.treetable('removeNode', id);
                                var p = idList[par];
                                var name = id.split('.');
                                name = name[name.length - 1];
                                if (typeof p !== 'object') {
                                    p = workTree.folders[''];
                                    if (!p[name])
                                        p = workTree.folders;
                                }
                                delete p[name];
                                delete idList[id];
                                omachine = curId = null;
                                rebindTableCommands();
                            }
                        });
                }, 10));
            newClick('#input-add-timer', () => setTimeout(doCreateTimer, 20, '1m', curId));
            newClick(
                '#input-add-state', () => setTimeout(doCreateState, 20, 'new', curId));
            newClick(
                '.input-add-link', () => setTimeout(doCreateLink, 20));
            newClick(
                '#tab-events-content thead tr',
                function () {
                    selectRow($(this));
                });
            offOn($(document), 'keydown', function (event) {
                if (event.keyCode == 27) {
                    //                    showMessage('Escape hit on '+$(this))
                    if ($(document).data('$ia')) {
                        var $ia = $(document).data('$ia');
                        $ia.find('.chips').find('input').val('');
                        $ia.find('span.input-text').text('');
                        $ia.data('parsed-chip', null);
                    }

                }
            });
            var idt = {} // check if multiple items with same id exist, can be removed in production
            $('#script-down').click(function () {
                if (main.$parentOutput)
                    main.$parentOutput.scrollTop($('#script-output').height() + 50);
            }).css('cursor', 'pointer');
            $('#script-delete').click(function () {
                $('#script-output').html('');
            }).css('cursor', 'pointer');
            $('[id]').each(function () {
                id = $(this).prop('id');
                idt[id] = (idt[id] || 0) + 1;
                if (idt[id] > 1)
                    console.log('double HTML-id: ' + id);
            });
            $('#vis-fit').click(function () {
                if (network)
                    network.fit();
            }).css('cursor', 'pointer');
            $('#vis-delete').click(function () {
                var d = Number.POSITIVE_INFINITY;
                for (var k in main.history) {
                    var h = main.history[k];
                    var lk = parseInt(ownKeysSorted(h).slice(-1)[0]);
                    var nk = {
                        [lk]: h[lk]
                    };
                    main.history[k] = nk;
                    if (d > lk)
                        d = lk;
                }
                startDate = new Date(d);
                if (network && network.timeAxis) {
                    ndata = {};
                    setTimeout(doMachine, 5, curId);
                }
            }).css('cursor', 'pointer');
            $('#vis-delete-all').click(function () {
                for (var k in main.history) {
                    main.history[k] = {};
                }
                startDate = new Date();
                if (network && network.timeAxis) {
                    ndata = {};
                    setTimeout(doMachine, 5, curId);
                }
            }).css('cursor', 'pointer');

        }

        function getNameData(write) {
            if (nameData && !write)
                return nameData;
            var ac = {};
            for (var as in main.sstate) {
                var id = main.sstate[as];
                if (!write || (main.objects[id] && main.objects[id].common.write))
                    ac[as] = getIcon(as);
            }
            for (var am of ownKeys(idList)) {
                var ty = [MACHINE, EVENT, SCENE].indexOf(idList[am][F_type]);
                if (ty >= 0)
                    if (!ac[am])
                        ac[am] = getIcon(am);
            }
            for (var ast of ['sunrise', 'sunset', 'sunriseEnd', 'sunsetStart', 'dawn', 'dusk', 'nauticalDawn',
                    'nauticalDusk', 'nightEnd', 'night', 'goldenHourEnd', 'goldenHour'
                ])
                ac['@' + ast] = getIcon('astro.png');
            if (!write) {
                nameData = ac;
                setTimeout(() => (namedata = null), 600000);
            }
            return ac;
        }

        function offOn($s, e, fun) {
            return makeSel($s).off(e).on(e, fun);
        }

        function parseActionChip(name) { // timedistance
            var c = {};
            if (typeof name === 'object') {
                c = cloneObject(name);
                name = c.tag;
            }
            c.tag = name = name ? name.trim() : '';
            var m; // evry xxx delay
            if (m = name.match(regDelay)) {
                var a = [];
                var ts = 0;
                for (var i = 1; i < 4; ++i) {
                    var s = m[i];
                    if (s) {
                        while (s[s.length - 1] > '9')
                            s = s.slice(0, -1);
                        s = parseInt(s);
                        ts += s * [0, 60 * 1000, 1000, 1][i];
                        var ns = '' + s + ['', ' Minute', ' Second', ' MilliSecond'][i];
                        if (s)
                            a.push(ns + (s > 1 ? 's' : ''));
                    }
                }
                if (ts) {
                    c.text = 'Timer: ' + a.join(', ');
                    c.timems = ts;
                    c.name = name;
                    c.image = 'lib/img/hourglass.png';
                    return c;
                }
            } // exec command on system
            if (m = name.match(regExec)) {
                c.cmd = m[1] ? m[1].trim() : undefined;
                c.text = 'Exec: ' + c.cmd;
                c.image = 'lib/img/exe.png';
                return c;
            } // eval javascript
            if (m = name.match(regEval)) {
                c.eval = m[1] ? m[1].trim() : undefined;
                c.text = 'Eval: ' + c.eval;
                c.image = 'lib/img/js.png';
                return c;
            }
            if (!(m = name.match(regIdAction)))
                return null;
            c.exec = m[5] ? m[5].trim() : '';
            c.always = !!m[4];
            c.ack = !!m[3];
            c.queue = !!m[2];
            //                c.ack = m[1] ? m[1] : undefined;
            c.idn = m[1] ? m[1].trim() : undefined;
            var id = main.sstate[c.idn];
            var ce = {
                '': 'Set Input ',
                '~': "Toggle ",
                '=+': "Set On ",
                '=-': "Set Off ",
                '=!': 'Set Not Input ',
                '=?': 'Set Input ',
            };
            c.text = ce[c.exec] ? ce[c.exec] : c.exec + ' ';
            c.text += id ? '' : 'Undefined Id! '
            c.text += c.idn + (id && c.idn != id ? ' (' + id + ')' : '');
            if (c.queue)
                c.text += ' queued';
            if (c.ack)
                c.text += ' with ack';
            if (c.always)
                c.text += ' always';
            c.image = getIcon(c.idn);
            if (!c.image)
                c.image = 'lib/img/run.png';
            return c;
        }

        function parseEventChip(name) { // timedistance
            var c = {};
            if (typeof name === 'object') {
                c = cloneObject(name);
                name = c.tag;
            }
            c.tag = name = name ? name.trim() : '';
            var m; // evry xxx timer
            if (m = name.match(regEvery)) {
                var a = [];
                var ts = 0;
                for (var i = 1; i < 6; ++i) {
                    var s = m[i];
                    if (s) {
                        if (s[s.length - 1] > '9')
                            s = s.slice(0, -1);
                        s = parseInt(s);
                        ts += s * [0, 7 * 24 * 60 * 60, 24 * 60 * 60, 60 * 60, 60, 1][i];
                        var ns = '' + s + ['', ' Week', ' Day', ' Hour', ' Minute', ' Second'][i];
                        if (s)
                            a.push(ns + (s > 1 ? 's' : ''));
                    }
                }
                if (ts) {
                    c.timer = a.join(', ');
                    c.text = 'Every ' + c.timer;
                    c.times = ts;
                    c.name = name;
                    c.image = 'lib/img/timer-icon-timelapse.png';
                    return c;
                }
            } // time
            if (m = name.match(regTime)) {
                if (m[3] == undefined)
                    m[3] = 0;
                c.schedule = m[3] + ' ' + m[2] + ' ' + m[1] + ' * * *';
                c.text = 'At ' + c.schedule;
                c.image = 'lib/img/schedule_24h.png';
                c.name = name;
                return c;
            } // schedule
            if (m = name.match(regSchedule)) {
                c.schedule = (!m[2] ? '* ' : '') + name;
                c.text = 'Schedule ' + c.schedule;
                c.timer = name;
                c.image = 'lib/img/timer-icon-schedule.png';
                return c;
            }; // astro 
            if (m = name.match(regAstro)) {
                c.astro = m[1];
                c.timer = parseInt(m[2]);
                c.text = 'Astro(' + c.astro + ') ' + (c.timer ? (c.timer > 0 ? '+' : '') + c.timer + ' min' : '');
                c.image = 'lib/img/astro.png';
                return c;
            };
            if (!(m = name.match(regRegexp)) && !(m = name.match(regId)))
                return null;
            c.onchange = !!m[3];
            c.ack = m[2];
            c.idn = m[1].trim();
            c.image = getIcon(c.idn);
            if (!c.image)
                c.image = 'lib/img/flash.png';
            c.test = m[5] ? c.test = m[5].trim() : '';
            c.check = m[4];
            c.text = c.onchange ? 'On change ' : '';
            c.text += c.ack == '!' ? 'No Ack ' : (c.ack == '&' ? 'Witch Ack ' : 'Any Ack ');
            c.text += c.idn;
            if (c.idn != main.sstate[c.idn])
                c.text += (c.idn.startsWith('/') || c.idn.indexOf('*') >= 0) ? ' (RegExp) ' :
                ' (' + main.sstate[c.idn] + ') ';
            if (c.check)
                c.text += c.check + ' ' + (c.test ? c.test : '(last value)');
            return c;
        }

        function rebindActionData(inputArea, oid, field, parser, icon, text) {
            function parseChip(chip) {
                var fun = $ia.data('parsed-fun');
                return fun ? fun(chip) : null;
            }

            function makeChips(data, auto) {
                var opt = {
                    data: data,
                    placeholder: 'Enter an event',
                    secondaryPlaceholder: '+event',
                };
                if (auto)
                    opt.autocompleteOptions = {
                        data: auto,
                        limit: Infinity,
                        minLength: 1
                    }

                $ic.material_chip(opt);
                $(document).data('$ia', '');
                offOn($ic.find('input'), 'focusin', function () {
                    var v = $(this).val().trim();
                    var c = parseChip(v);
                    var o = $ia.data('parsed-chip');
                    var s = $ic.find('.chip.selected').text();
                    if (o && o.oid) {
                        o.tag = v;
                        c = parseChip(o);
                    }
                    $ia.data('parsed-chip', c);
                    if (c) {
                        $('a.chips-move').hide();
                        // addEvent(c, 'Focus...');
                        $(document).data('$ia', $ia);
                        $it.text(c.text);
                    }
                });
                offOn($ic.find('input'), 'input', function () {
                    var v = $(this).val().trim();
                    var c = parseChip(v);
                    var o = $ia.data('parsed-chip');
                    var s = $ic.find('.chip.selected').text();
                    if (o && o.oid) {
                        o.tag = v;
                        c = parseChip(o);
                    }
                    if (c && o && o.oid !== undefined)
                        c.oid = o.oid;
                    $ia.data('parsed-chip', c);
                    $(document).data('$ia', $ia);
                    if (c) {
                        // addEvent(c, 'Chip...');
                        $it.text(c.text);
                    }
                });
                offOn($ic.find('div.chip'), 'mousedown', function () {
                    var v = $(this)[0].childNodes[1].nodeValue;
                    var o = $ia.data('parsed-chip');
                    if (o && o.tag === v) {
                        $ia.data('parsed-chip', '');
                        setTimeout(function (t, o) {
                            deselectChip();
                        }, 10, this, o);
                    }
                });
            }

            function chipMove($ia, dir) {
                var chips = $ic.material_chip('data');
                var chip = $ia.data('parsed-chip');
                if (chip && chips && chip.tag) {
                    var tc = chips.findIndex((x) => x.tag === chip.tag);
                    if (tc >= 0) {
                        var c = chips[tc];
                        chips.splice(tc + dir, 0, chips.splice(tc, 1)[0]);
                        if (idList[oid] && field)
                            idList[oid][field] = chips.map(c => c.tag);
                        deselectChip();
                        makeChips(chips, getNameData());
                        checkConfig();
                    }
                }
            }

            function updateChips(object, gotoId) {
                var chips = $ic.material_chip('data');
                if (chips && chips.length && chips[chips.length - 1].oid !== undefined) {
                    var lc = chips[chips.length - 1];
                    var oid = lc.oid;
                    delete lc.oid;
                    for (var c in chips)
                        if (chips[c].tag == oid) {
                            chips[c] = lc;
                            break;
                        }
                    chips = chips.slice(0, -1);
                }
                $('a.chips-move').hide();
                if (idList[object] && gotoId)
                    idList[object][gotoId] = chips.map(c => c.tag);
                makeChips(chips, getNameData());
                checkConfig();
            }


            function deselectChip() {
                $ia.data('parsed-chip', null);
                $(document).data('$ia', '');
                $('a.chips-move').hide();
                //                            addEvent(o, "deselect");
                $ic.find('input').val('');
                $ia.find('span.input-text').text('');

            }

            var $ia = $(inputArea);
            $ia.data('d-id', oid).data('parsed-fun', parser);
            var $it = $ia.find('span.input-text');
            $ia.find('label.data-title').text(text);
            $ia.find('.data-icon').text(icon);
            var obj = oid && idList[oid];
            var chips = obj && obj[field];
            chips = chips || [];
            var data = chips.map(function (c) {
                var p = parseChip(c);
                return p ? p : {};
            });
            var $ic = $ia.find('.chips');
            $('a.chips-move').hide();
            $('span.input-text').text('');
            makeChips(data, getNameData(field != F_fire));
            offOn($ic, 'chip.add', function (e, chip) {
                var o = $ia.data('parsed-chip');
                var c = parseChip(chip);
                for (var i of ownKeys(c))
                    chip[i] = c[i];
                if (o && o.oid !== undefined)
                    chip.oid = c.oid = o.oid;
                $ia.data('parsed-chip', c);
                $it.text('');
                setTimeout(function () {
                    updateChips(oid, field);
                    //                    $ia.find('div.chip.selected').removeClass('selected');
                    //                   $ic.find('div.chip').last().addClass('selected');
                    //                   selectChip($ia, chip);
                }, 10);
                // addEvent(c, 'Chip.add');
                return true;
            });
            offOn($ic, 'chip.delete', function (e, chip) {
                // addEvent(chip, 'Chip.Delete');
                // addEvent($ic.material_chip('data'), 'All chips');
                $ia.data('parsed-chip', null);
                updateChips(oid, field);
            });
            offOn($ic, 'chip.select', function (e, chip) {
                if (chip.oid === undefined)
                    chip.oid = chip.tag;
                selectChip($ia, chip);
            });
            offOn($ia.find('a.chips-left'), 'click', function () {
                setTimeout(chipMove, 1, $ia, -1);
            });
            offOn($ia.find('a.chips-right'), 'click', function () {
                setTimeout(chipMove, 1, $ia, 1);
            });
            offOn($ia.find('a.show-help'), 'click', function () {
                var $h = $(this).closest('.input-table');
                if (!$h.next('.input-table-help').length > 0)
                    $h = $h.next();
                $h = $h.next('.input-table-help');
                var s = !$h.data('shown');
                $h.data('shown', s);
                if (!s)
                    $h.hide();
                else
                    $h.show();
            })
            $ia.show();
            $('.input-table-help').data('shown',false).hide();
            // setDebug(workTree.debugLevel);
            offOn('a.input-rename', 'click', function () {
                var $t = $(this);
                var $h = $(this).closest('.input-table');
                var $i = $h.find('.input-field input');
                var nname = $i.val().trim();
                var aname = curId.split('.');
                var oname = aname.slice(-1)[0];
                var pname = aname.slice(0, -1).join('.');
                var vid = (pname ? pname + '.' : '') + nname;
                if (idList[vid])
                    return showError(`New id ${vid} already in use!`);
                confirmMessage(
                    `Do you really want to rename '${oname}' to '${nname}'?<br>You need to change the names manually in events or actions!`,
                    'Rename', 'help', 2,
                    function (ok) {
                        if (!ok)
                            return;
                        var p = pname ? idList[pname] : workTree.folders[""];
                        var no = p[nname] = p[oname];
                        delete p[oname];
                        idList[vid] = idList[curId];
                        delete idList[curId];
                        idList[vid][F_id] = vid;
                        if (p[F_type] === MACHINE) {
                            if (p[F_default] == oname)
                                p[F_default] = nname;
                            for (var s of ownKeys(p))
                                if (!s.startsWith(' ')) {
                                    if (s.startsWith(autoLink)) {
                                        if (s.slice(1) == oname) {
                                            p[autoLink + nname] = p[s];
                                            delete p[s];
                                        }
                                    } else {
                                        var os = p[s];
                                        if (os[F_type] == TIMER && os[F_timeout] ==
                                            oname)
                                            os[F_timeout] = nname;
                                        for (var nk of ownKeys(os))
                                            if (!nk.startsWith(' '))
                                                if (nk == oname) {
                                                    os[nname] = os[nk];
                                                    delete os[nk];
                                                }

                                    }
                                }
                        }
                        regenSelect(vid);
                    });
            });
        }

        function selectChip($ia, chip) {
            var fun = $ia.data('parsed-fun');
            if (fun)
                chip = fun(chip);
            $ia.data('parsed-chip', chip);
            // addEvent(chip, 'Chip.select');
            $('span.input-text').text('');
            $ia.find('span.input-text').text(chip ? chip.text : '');
            if (chip)
                $ia.find('.chips input').val(chip.tag);
            var chips = $ia.find('.chips').material_chip('data');
            var tc = chips.findIndex((x) => x.tag === chip.tag);
            $('a.chips-move').hide();
            if (tc < chips.length - 1)
                $ia.find('a.chips-right').show();
            if (tc > 0)
                $ia.find('a.chips-left').show();
        }


        function getIcon(id) {
            if (main.icons[id])
                return main.icons[id];
            if (idList[id])
                return getIcon(['statemachine', 'flash.png', 'list.png'][
                    [MACHINE, EVENT, SCENE].indexOf(idList[id][F_type])
                ]);
            if (main.sstate[id])
                id = main.sstate[id];
            if (main.icons[id])
                return main.icons[id];
            if (main.icons[id.split('.').slice(0, -1).join('.')])
                return main.icons[id.split('.').slice(0, -1).join('.')];
            if (id.endsWith('.png'))
                return 'lib/img/' + id;
            id = id.split('.')[0];
            if (main.icons[id])
                return main.icons[id];
            return null;
        }

        function validateInput($this) {
            if (typeof $this === 'string')
                $this = $($this);
            var nok = '';
            var val = $this.val();
            var c = $this.attr('minlength');
            if (c && val.length < c)
                nok = `input too short: you have ${val.length} out of minimal ${c}!`;
            else {
                c = $this.attr('maxlength');
                if (c && val.length > c)
                    nok = `input too long: you have ${val.length} out of maximal ${c}!`;
                else {
                    c = $this.attr('pattern');
                    if (c && !(new RegExp(c)).test(val))
                        nok = $this.attr('title') ? $this.attr('title') : 'Field must match pattern ' + c;
                }
            }
            $this.next().attr('data-error', nok === true ? '' : nok);
            $this.toggleClass('invalid', !!nok);
            return !nok;
        }

        function makeTr(id, parent, name, icon, obj, dis) {
            //            idList[id] = obj;
            var wic = 0;
            var disabled = (obj && obj[F_disabled]) || dis;
            var type;
            var mach;
            if (icon === I_State || icon === I_Timer) {
                mach = parent;
                mach = getValue(parent, false);
                obj[F_active] = mach;
            } else if (icon === I_Machine) {
                obj[F_active] = getValue(id, false);
            }
            var html =
                `<tr data-tt-id="${id}"${parent ? ' data-tt-parent-id="' + parent +'"' : ''}><td  class="ft ${disabled ? ' disabled' : ''}" width="${wi[wic++]}"><span><i class="material-icons tiny right">${icon}</i>&nbsp;${name}</span>&nbsp;&nbsp;</td>`;
            html +=
                `<td class="fd id-field${mach === name ? ' teal lighten-4' : ''}" width="${wi[wic++]}">${id}`;
            if ([I_Machine, I_Folder].indexOf(icon) < 0 && id !== '_debugLevel')
                html +=
                `<a title="Run Item" class="input-execute btn-floating btn btn-small waves-effect waves-light orange right">
                    <i class="material-icons" my-icon="Event">${I_Event}</i></a>`;
            html += `</td><td class="fd" width="${wi[wic++]}">`;
            if ([I_Machine, I_Folder, I_Event, I_Scene].indexOf(icon) >= 0 && id !== '_init' && id !== '_debugLevel')
                //                        html += `<span><input type="checkbox" id="d-${id}" ${disabled ? '' : 'checked="checked"'}/><label for="d-${id}">Enabled</label></span>`;
                html +=
                `<div class="switch left"><label>Off<input class="is-disabled" type="checkbox" ${disabled ? '' : 'checked="checked"'}><span class="lever"></span>On</label></div>`;
            html += '&nbsp;';
            if ([I_Machine, I_Event, I_Scene].indexOf(icon) >= 0)
                html +=
                `<span s-v="${main.instanceName(id)}" class="right">${getValue(main.instanceName(id),true)}</span>`;

            html += '</td></tr>\n';
            return html;
        }

        function createFolderTree(complete) {
            function traverseConfig(id, name, parent, obj, dis) {
                var items = ownKeysSorted(obj);
                var hasitems = items.length > 0 && !items[items.length - 1].startsWith(' ');
                var id = id || name;
                var timer = (items.indexOf(F_timeout) >= 0) ? obj[F_timeout] : '';
                var type = obj[F_type];
                var icon = ticons[type];
                dis = dis || obj[F_disabled];
                if (type === LINK && name.startsWith(autoLink))
                    icon = I_LinkAuto;
                if (name)
                    html += makeTr(id, parent, name, icon, obj, dis);
                if (id) {
                    idList[id] = obj;
                    obj[F_id] = id;
                }
                for (var k of items)
                    if (!k.startsWith(' ')) {
                        nobj = obj[k];
                        if (typeof nobj === 'object')
                            traverseConfig(id ? id + '.' + k : k, k, id, nobj, dis);
                    }
            }

            var html = '';
            wi = [];
            $('#tree').find('thead tr th').each(function () {
                wi.push($(this).prop('width'));
            });
            idList = {};
            omachine = null;
            workTree.folders = copySorted(workTree.folders);
            for (var m of ownKeysSorted(workTree.folders))
                traverseConfig('', m, '', workTree.folders[m], false);
            $('#table-data').html(html);
            $table.treetable({
                expandable: true,
                onNodeExpand: function () {
                    if (idList[this.id] && [MACHINE, STATE, TIMER, 'folder'].indexOf(idList[
                            this.id][
                            F_type
                        ]) >= 0)
                        idList[this.id][F_expanded] = true;
                    checkConfig();
                },
                onNodeCollapse: function () {
                    if (idList[this.id])
                        delete idList[this.id][F_expanded];
                    checkConfig();
                },
                indent: 24,
                stringCollapse: "Collapse",
                stringExpand: "Expand",
            }, true);

            function autoexpand(obj, id) {
                if (!obj || typeof obj !== 'object')
                    return;
                if (obj[F_expanded])
                    $table.treetable("expandNode", id);
                for (var k of ownKeys(obj))
                    if (k.match(/^[ \*]/))
                        continue;
                autoexpand(obj[k], id ? id + '.' + k : k);
            }
            autoexpand(workTree.folders, '');
            // Highlight selected row
            nameData = null;
            rebindTableCommands();
        }

        function checkMachines() {
            var states = {},
                machines = {},
                ids = {},
                err = 0;

            function se(str) {
                showError(str);
                err++;
            }

            function setst(parent, state) {
                var name = parent ? parent + '.' + state : state;
                states[name] = states[name] ? states[name] + 1 : 1;
                return name;
            }

            function checkItem(parent, name, obj, pobj) {
                var typ = obj[F_type];
                var par = parent ? parent : '';
                var nam2 = name.startsWith(autoLink) ? name.slice(1) : name;
                var oid = parent ? parent + '.' + name : name;
                var id = parent ? parent + '.' + nam2 : nam2;
                ids[oid] = obj;
                for (var i of ownKeys(obj))
                    if (!i.startsWith(' ')) {
                        var nobj = obj[i];
                        var ntyp = nobj[F_type];
                        switch (ntyp) {
                            case STATE:
                                ids[id + '.' + i] = nobj;
                                machines[id] = machines[id] ? machines[id] + 1 : 1;
                                break;
                            case TIMER:
                                ids[id + '.' + i] = nobj;
                                machines[id] = machines[id] ? machines[id] + 1 : 1;
                                break;
                            case LINK:
                                if (i.startsWith(autoLink))
                                    setst(id, i.slice(1));
                                else
                                    setst(parent, i);
                        }
                    } else switch (i) {
                        case F_timeout:
                            setst(parent, obj[F_timeout]);
                            break;
                    }
                for (var i of ownKeys(obj))
                    if (!i.startsWith(' '))
                        checkItem(id, i, obj[i], obj);

                var t = ownKeys(obj).filter(x => !x.startsWith(' ') && !x.startsWith(autoLink));
                switch (typ) {
                    case MACHINE:
                        if (obj[F_default])
                            if (!obj[obj[F_default]])
                                se(`Machine '${id}' has invalid default state '${obj[F_default]}'`);
                        if (t.length < 2)
                            se(`Machine '${id}' has less than two states (${t})!`)
                        for (var s of t)
                            if (!states[id + '.' + s])
                                se(`State '${id+'.'+s}' has no links pointing to it!`)
                        break;
                    case STATE:
                        if (t.length < 1)
                            se(`State '${id}' needs at least one Link!`)
                        break;
                    case TIMER:
                        if (obj[F_timeout])
                            if (!pobj[obj[F_timeout]])
                                se(`Timer '${id}' has invalid timeout state '${obj[F_default]}'`);
                        break;
                    case LINK:
                        if (name != nam2) {
                            if (!pobj[nam2])
                                se(`AutoLink '${id}' has invalid state '${nam2}'`);
                        } else {
                            var np = parent.split('.').slice(0, -1);
                            np.push(name);
                            np = np.join('.');
                            if (!ids[np])
                                se(`Link '${parent}' has invalid state '${name}'`);
                        }

                }
            }
            var folders = cloneObject(workTree.folders);
            for (var i of ownKeys(folders))
                checkItem("", i, folders[i], null);
            return err;
        }

        function isAnyChanged(str) {
            var o = (str = makeSel(str)).data('old');
            var ch = o != str.val().trim();
            enableDisable(str.closest('div.input-table').find('a.input-rename'), ch);
        }

        function makeSel($sel) {
            return typeof $sel === 'string' ? $($sel) : $sel;
        }

        function popStates($sel, m, val) {
            if (typeof m == 'string')
                m = idList[m];
            var html = '';
            if (!val)
                val = '';
            var ss = val.startsWith(autoLink) ? autoLink : '';
            if (val === '')
                html += `<option value="" selected>Not set</option>`;

            getStates(m).forEach(function (s) {
                html += `<option value="${ss+s}"${val == ss+s ? ' selected' : ''}>${ss+s}</option>`;
            });

            ($sel = makeSel($sel)).html(html).material_select();
            return $sel;
        }

        function selectId(id) {
            $table.treetable('reveal', id);
            selectRow($table.find('tr[data-tt-id="' + id + '"]'));
        }

        function regenSelect(id) {
            setTimeout(() => {
                createFolderTree();
                setTimeout(selectId, 100, id);
                checkConfig();
            }, 10);
        }


        function setOld($sel, val) {
            return makeSel($sel).val(val).data('old', val);
        }

        function selectRow($this) {
            $("#tab-events-content tr.selected").removeClass("selected blue lighten-4");
            curId = $this.data('ttId');
            if (!curId) {
                $('div.input-table').hide();
                return;
            }
            curPar = $this.data('ttParentId');
            var ido = idList[curId];
            var ty = ido && ido[F_type];
            var ids = curId.split('.');
            var x = ids[0];
            $('#input-folder').val("");
            if (idList[x] && idList[x][F_type] === 'folder') {
                $('#input-folder').val(curFolder = x);
                if (ids.length > 1)
                    x += '.' + ids[1];
            } else curFolder = null;
            var x2 = idList[x][F_type];
            if (x2 === MACHINE) {
                $('#input-machine').val(curMachine = getThisName(x));
                $('#input-event,#input-scene').val(curEvent = '');
                $('#input-name-machine').val(curMachine);
            } else if (x2 === EVENT) {
                $('#input-machine,#input-scene').val(curMachine = '');
                $('#input-event').val(curEvent = getThisName(x));
                $('#input-name-event').val(curEvent);
            } else if (x2 === SCENE) {
                $('#input-machine,#input-event').val(curMachine = '');
                $('#input-scene').val(curScene = getThisName(x));
                $('#input-name-scene').val(curScene);
            } else if (x2 === FOLDER) {
                $('#input-machine,#input-event,#input-scene').val(curScene = curEvent = curMachine = '');
                $('#input-folder').val(curFolder = getThisName(x));
                $('#input-name-folder').val(curFolder);
            }
            $('input.mach-val').removeClass('invalid');
            $('div.input-table').hide();
            $('#input-table-' + ty).show().find('span.input-value').attr('s-v', main.instanceName(curId)).html(getValue(
                main.instanceName(curId), true));
            var show = [];
            enableDisable('#input-rename-' + ty);
            offOn('input.input-function', 'input', function () {
                ido[F_function] = $(this).val();
                checkConfig();
            });

            switch (ty) {
                case 'folder':
                    $('#input-name-folder').val(curFolder);
                    break;
                case LINK:
                    x = curPar;
                    $('#input-link-from').text('From ' + getThisName(curPar) + ' to:');
                    if (idList[curPar][F_type] === MACHINE)
                        x = curId;
                    $('#input-link-icon').text(x === curId ? I_LinkAuto : I_Link);
                    offOn(setOld(popStates('#input-tostate-link', getParId(x), getThisName(curId)), ido[
                        F_timeout]), 'change', function () {
                        var n = curId.split('.').slice(-1)[0];
                        var p = idList[curPar];
                        var ns = $(this).val();
                        var nn = curPar + '.' + ns;
                        if (p[ns])
                            return showError(`State has already a link there!`)
                        if (p && p[n] && n != ns) {
                            p[ns] = p[n];
                            delete p[n];
                            p[ns][F_id] = nn;
                            setTimeout(createFolderTree, 10);
                            setTimeout(selectId, 100, nn);
                            checkConfig();
                        }
                    });
                    offOn($('#input-function-link').val(ido[F_function]), 'input', function () {
                        ido[F_function] = $(this).val();
                        checkConfig();
                    });
                    rebindActionData('#input-event-data', curId, F_fire, parseEventChip, I_Event,
                        'Events for new state, current id:');
                    break;
                case STATE:
                    offOn($('#input-name-state').val(getThisName(curId)).data('old', getThisName(curId)),
                        'input',
                        function () {
                            validateInput($(this));
                            isAnyChanged('#input-name-state');
                        });
                    rebindActionData('#input-action-data', curId, F_onEnter, parseActionChip, 'gps_fixed',
                        'Actions on Enter, current id:');
                    rebindActionData('#input-action-data1', curId, F_onExit, parseActionChip, 'gps_off',
                        'Actions on Exit, current id:');
                    break;
                case TIMER:
                    offOn(setOld('#input-name-timer', getThisName(curId)), 'input', function () {
                        validateInput($(this));
                        isAnyChanged('#input-name-timer');
                    });
                    offOn(popStates('#input-timeout-state', curPar, ido[F_timeout])
                        .data('old', ido[F_timeout]), 'change',
                        function () {
                            ido[F_timeout] = $(this).val();
                            checkConfig();
                        });
                    rebindActionData('#input-action-data', curId, F_onEnter, parseActionChip, 'gps_fixed',
                        'Actions on Enter, current id:');
                    rebindActionData('#input-action-data1', curId, F_onExit, parseActionChip, 'gps_off',
                        'Actions on Exit, current id:');
                    break;
                case SCENE:
                    rebindActionData('#input-action-data', curId, F_onFire, parseActionChip, I_Scene,
                        'Scene list, current id:');
                    break;
                case EVENT:
                    offOn($('#input-function-event').val(ido[F_function]), 'input', function () {
                        ido[F_function] = $(this).val();
                        checkConfig();
                    });
                    rebindActionData('#input-event-data', curId, F_fire, parseEventChip, I_Event,
                        'Events which fire, current id:');
                    rebindActionData('#input-action-data', curId, F_onFire, parseActionChip,
                        'directions_run',
                        'Action when fired, current id:');
                    break;
                case MACHINE:
                    offOn(popStates('#input-machine-states', curId, ido[F_default]), 'change', function () {
                        ido[F_default] = $(this).val();
                        checkConfig();
                    });
                    break;
            }
            Materialize.updateTextFields();
            // addEvent(ido, "Select Row");
            $this.addClass("selected blue lighten-4");
            setTimeout(doMachine, 10, curId);
        }

        function rebindTableCommands() {
            offOn($('#table-data').find("tr"), 'mousedown', function () {
                if (curId == $(this).data('ttId'))
                    return;
                selectRow($(this));
            });

            offOn($('#table-data').find("input.is-disabled"), 'change', function (e) {
                var tr = $(this).closest('tr');
                var id = tr.data('ttId');
                var idl = idList[id];
                var en = this.checked;
                tr.find('td.ft').toggleClass('disabled', !en);
                if (en && idl)
                    delete idl[F_disabled];
                else if (!en && idl)
                    idl[F_disabled] = true;
                $('#table-data').find("td.ft").each(function (i, e) {
                    var cid = $(this).closest('tr').data('ttId');
                    if (cid && cid.startsWith(id + '.'))
                        $(this).toggleClass('disabled', !(en && (idList[cid] && !idList[cid].disabled)));
                });
                main.setState(id + stateDisabled, !en);
                checkConfig();
                //                showMessage(id + (this.checked ? ' enabled' : ' disabled'));
            });
            offOn($('#table-data').find('a.input-execute'), 'mousedown', function (e) {
                e.stopImmediatePropagation();
                setTimeout((e, that) => {
                    var tr = $(that).closest('tr');
                    var cid = tr.data('ttId');
                    var mid;
                    var vid = cid.split('.').slice(-1)[0];
                    var id = idList[cid];
                    switch (id[F_type]) {
                        case TIMER:
                        case STATE:
                            mid = cid.split('.').slice(0, -1).join('.');
                            break;
                        case LINK:
                            mid = cid.split('.').slice(0, vid.startsWith(autoLink) ? -1 : -2).join(
                                '.');
                            if (vid.startsWith(autoLink))
                                vid = vid.slice(1);
                            break;
                        case SCENE:
                        case EVENT:
                            mid = main.instanceName(cid);
                            vid = main.states[mid] && main.states[mid].val;
                            break;
                    }
                    main.setState(mid, vid);;
                }, 0, e, this);
                return false;
            });

            checkConfig();
        }


        var omachine, network, ndata, startDate = new Date();

        function setNWindow() {
            if (!ndata || !ndata.istimeline || !network)
                return;
            var start = null;
            var end = new Date(Date.now() + 5000);
            if (!ndata.data.length)
                start = new Date();
            else if (ndata.data.length < 10)
                start = startDate;
            if (network && network.timeAxis) {
                var r = network.getItemRange();
                if (!r) return;
                var min = (r.min &&
                    r.min.valueOf()) || startDate;
                var max = (r.max && r.max.valueOf()) || new Date();
                end = Math.floor((max - min) / 0.93) + min;
                network.setWindow(start, new Date(end));
            }
        }

        function addVal(i, id, nowin) {
            // console.log(id, i);
            if (!ndata || !ndata.istimeline || !id || !i)
                return;
            if (!ndata.groups || !ndata.groups.get(id))
                return;
            var item = {
                id: '' + i.ts.valueOf() + id,
                group: id,
                start: i.ts,
                title: new Date(i.ts.valueOf() - (new Date().getTimezoneOffset() * 60000)).toISOString().replace(
                    'T', '<br>').replace('Z', '')
            };
            item.content = typeof i.val === 'boolean' ?
                `<i class="tiny material-icons">${i.val ? 'add_circle' : 'remove_circle_outline'}</i>` : getValue(id,
                    true, i);
            if (i.from)
                item.title += '<br>' + (i.from.startsWith('system.adapter.') ? i.from.slice(15) : i.from);
            if (!i.ack)
                item.className = 'teal lighten-3';
            //            if (i.ack)
            //            item.type = 'point';
            ndata.data.add(item);
            if (!nowin)
                setNWindow();
        }

        function doMachine(curId) {
            var container = document.getElementById('mynetwork');
            var id = (curFolder ? curFolder + '.' : '') + curMachine;
            var ido = idList[id];
            if (!ido || ido[F_type] !== MACHINE) {
                omachine = '***';
                if (ndata && ndata.istimeline && curFolder === ndata.folder)
                    return network ? network.setWindow(null, new Date()) : null;
                if (network)
                    network.destroy();
                $('#mynetwork').html('');
                var groups = new vis.DataSet();
                var data = new vis.DataSet();
                ndata = {
                    data: data,
                    folder: curFolder,
                    groups: groups,
                    istimeline: true
                };
                for (var k of ownKeysSorted(workTree.folders[curFolder ? curFolder : '']))
                    if (k.startsWith(' '))
                        continue;
                    else {
                        var id = (curFolder ? curFolder + '.' : '') + k;
                        if (id === '_init')
                            continue;
                        groups.add({
                            id: id,
                            order: groups.length,
                            content: id
                        });
                        for (var i of main.getHistory(id))
                            addVal(i, id, true);
                    }
                var options = {
                    showCurrentTime: false,
                    start: startDate
                };
                network = new vis.Timeline(container, data, groups, options);
                $('#mynetwork').show();
                setNWindow();
                return;
            }
            if (ndata && ndata.istimeline) {
                if (network) {
                    try {
                        network.destroy();
                    } catch (e) {};
                    network = null;
                }
                $('#mynetwork').html('');
            }
            $('#event-span').show();
            $('#mynetwork').show();
            if (omachine !== id) {
                var options = {
                    nodes: {
                        borderWidth: 3,
                        borderWidthSelected: 6,
                        shapeProperties: {
                            borderDashes: true,
                        },
                        size: 30,
                    },
                    edges: {
                        //                        color: 'darkgray',
                        arrows: {
                            to: {
                                enabled: true,
                                scaleFactor: 1.9
                            }
                        },
                        font: {
                            size: 18
                        },
                        arrowStrikethrough: false,
                        selfReferenceSize: 40,
                        smooth: {
                            forceDirection: "none",
                            //                            roundness: 0.6
                        }
                    },
                    physics: {
                        barnesHut: {
                            springLength: 300,
                            avoidOverlap: 0.42
                        },
                        minVelocity: 0.75
                    },
                    interaction: {
                        selectConnectedEdges: false
                    }
                };
                var idn = curId;
                var nodes = [{
                        id: curMachine,
                        label: curMachine,
                        shape: 'star',
                        shapeProperties: {
                            borderDashes: !!ido[F_disabled],
                        },
                        title: id,
                        font: {
                            size: 30
                        },
                        size: 40,
                        color: {
                            highlight: {
                                background: 'pink',
                                border: 'purple'
                            },
                            background: 'pink',
                            border: 'purple'
                        },
                    }],
                    edges = [];

                omachine = id;

                for (var nf of ownKeysSorted(ido)) {
                    if (nf.startsWith(' '))
                        continue;
                    else if (nf.startsWith('*')) {
                        edges.push({
                            from: curMachine,
                            to: nf.slice(1),
                            arrows: {
                                to: {
                                    scaleFactor: 2
                                }
                            },
                            label: nf,
                            id: nf,
                            title: id + '.' + nf,
                        });
                    } else {
                        var st = ido[nf];
                        var it = st[F_type] === TIMER;
                        var aid = id + '.' + nf;
                        var nn = {
                            label: nf,
                            id: nf,
                            title: aid,
                            shape: it ? 'box' : 'ellipse',
                            font: {
                                size: 30
                            },
                            color: it ? {
                                highlight: {
                                    background: 'yellow',
                                    border: 'darkgreen'
                                },
                                background: 'yellow',
                                border: 'darkgreen'
                            } : {
                                background: 'lightblue',
                                border: 'darkblue'
                            }
                        };
                        nn.shapeProperties = {
                            borderDashes: ido[F_active] !== nf
                        };
                        nodes.push(nn);
                        if (it) {
                            var to = st[F_timeout];
                            edges.push({
                                from: nf,
                                to: to,
                                arrows: {
                                    to: {
                                        scaleFactor: 1.2
                                    }
                                },
                                dashes: true,
                                label: nf,
                                title: 'timeout of ' + aid,
                                id: nf
                            });
                        }
                        for (var ns of ownKeysSorted(st))
                            if (ns.startsWith(' '))
                                continue;
                            else edges.push({
                                from: nf,
                                title: aid + '.' + ns,
                                to: ns,
                                label: nf + '>' + ns,
                                id: nf + '>' + ns
                            });
                    }
                }

                ndata = {
                    nodes: new vis.DataSet(nodes),
                    edges: new vis.DataSet(edges),
                    folder: '***'
                };
                network = new vis.Network(container, ndata, options);
                network.on("selectNode", function (params) {
                    // console.log('selectNode Event:', params);
                    if (params && params.nodes && params.nodes.length === 1 && params.nodes[0]) {
                        var n = ndata.nodes.get(params.nodes[0]);
                        if (n) {
                            // console.log('selectNode:', n.title);
                            setTimeout(selectId, 0, n.title);
                        }
                    }
                    return true;
                });
                network.on("selectEdge", function (params) {
                    // console.log('selectEdge Event:', params);
                    if (params && params.edges && params.nodes.length === 0 && params.edges.length === 1 &&
                        params.edges[0]) {
                        var e = ndata.edges.get(params.edges[0]);
                        if (e) {
                            e = e.title;
                            // console.log('selectEdge:', e);
                            if (e.startsWith('timeout of '))
                                e = e.slice(11);
                            setTimeout(selectId, 0, e);
                        }
                    }
                    return true;
                });
            }

            if (curId.startsWith(omachine) && network) {
                var sta = curId.slice(omachine.length + 1).split('.');
                if (sta.length == 2)
                    network.selectEdges([sta.join('>')]);
                else if (length.sta < 1 || !sta[0])
                    network.selectNodes([curMachine], false);
                else if (!sta[0].startsWith('*'))
                    network.selectNodes([sta[0]], false);
                else
                    network.selectEdges([sta[0]], false);
            }
        }

        function getParId(id) {
            var s = id.split('.');
            return s.length > 0 ? s.slice(0, -1).join('.') : '';
        }

        function getThisName(id) {
            var s = id.split('.');
            return s.length > 0 ? s[s.length - 1] : '';
        }

        function getTreeNode(id) {
            return $table.treetable('node', id);
        }

        function addId(id, parent, icon, opt) {
            opt = opt || {};
            var idr, type, ids = parent ? parent + '.' + id : id;
            switch (icon) {
                case I_Link:
                    type = LINK;
                    break;
                case I_LinkAuto:
                    type = LINK
                    break;
                case I_Folder:
                    type = 'folder';
                    break;
                case I_Machine:
                    type = MACHINE;
                    break;
                case I_Event:
                    type = EVENT;
                    break;
                case I_Scene:
                    type = SCENE;
                    break;
                case I_State:
                    type = STATE;
                    break;
                case I_Timer:
                    type = TIMER;
                    break;
            }
            if (type && !opt[type])
                opt[F_type] = type;

            if (icon == I_Folder)
                idr = workTree.folders;
            else
                idr = parent ? idList[parent] : workTree.folders[''];
            if (!idr || idList[ids])
                return showError(`cannot add id type '${icon}' '${id}' to parent '${parent}'!`);
            else {
                idList[ids] = opt;
                opt[F_id] = ids;
            }
            var html = makeTr(ids, parent, id, icon, opt);
            $table.treetable('loadBranch', (parent ? getTreeNode(parent) : null), html);
            if (parent)
                $table.treetable('sortBranch', getTreeNode(parent), function (a, b) {
                    if (a.id > b.id) return 1;
                    if (a.id < b.id) return -1;
                    return 0;
                });
            $table.treetable('reveal', ids)
            omachine = null;
            rebindTableCommands();
        }

        function copySorted(obj) {
            if (!obj)
                return obj;
            if (typeof obj !== 'object' || Array.isArray(obj))
                return cloneObject(obj);
            var n = {};
            for (var k of ownKeysSorted(obj)) {
                n[k] = copySorted(obj[k]);
            }
            return n;
        }

        function doCreateState(txt, folder) {
            var fs = folder ? folder + '.' : '';
            showInputModal({
                title: 'Create State',
                text: '',
                button: 'Create',
                flds: [
                    ['State Name', I_State, txt]
                ],
                callback: function (ok) {
                    if (ok && (ok = ok[0].trim())) {
                        if (!regStateName.test(ok))
                            showMessage('invalid name, please change $-_A-Za-z0-9 3-20 chars!');
                        else if (idList[fs + ok])
                            showMessage('Name already used, please change!');
                        else {
                            addId(ok, folder, I_State, idList[curId][ok] = {});
                            return regenSelect(folder + '.' + ok);
                        }
                        setTimeout(doCreateState, 30, txt, folder);
                    }
                }
            });
        }

        function getStates(m) {
            if (typeof m === 'string')
                m = idList[m];
            return m && ownKeysSorted(m).filter(s => !s.startsWith(' ') && !s.startsWith(autoLink))
        }

        function doCreateLink() {
            var s = idList[curId][F_type];
            var icon = I_LinkAuto;
            var m = curId;
            var t = 'Autolink';
            if (s !== MACHINE) {
                m = getParId(curId);
                icon = I_Link;
                t = 'Link';
            }
            var xs = getStates(m);
            if (!xs)
                return showError(`Cold not create ${t} for '${curId}'`);
            if (icon == I_LinkAuto)
                xs = xs.map(x => autoLink + x);
            showInputModal({
                title: 'Create ' + t,
                text: '',
                button: 'Create',
                flds: [
                    [t + ' from ' + curId, icon, xs]
                ],
                callback: function (ok) {
                    if (ok) {
                        var t = ok[0];
                        if (t && t.startsWith(autoLink))
                            t = t.slice(1);
                        if (!idList[m + '.' + t])
                            showMessage('You need to select an existing state!');
                        else {
                            addId(ok[0], curId, icon, idList[curId][ok[0]] = {});
                            return regenSelect(curId + '.' + ok[0]);
                        }
                        setTimeout(doCreateLink, 50);
                    }
                }
            });
        }

        function doCreateTimer(txt, folder) {
            var fs = folder ? folder + '.' : '';
            var m = idList[folder];
            var xs = m && getStates(m);
            if (!xs)
                return showError(`Cold not create timer for machine '${folder}'`);
            showInputModal({
                title: 'Create Timer',
                text: '',
                button: 'Create',
                flds: [
                    ['Timeout time', I_Timer, txt],
                    ['Timeout state', I_Timeout, xs]
                ],
                callback: function (ok) {
                    if (ok) {
                        var t = ok[0].trim();
                        if (!regTimerName.test(t))
                            showMessage('invalid timer: (1+w)(1+d)(1+h)(1+m)(1+((m)s))');
                        else if (idList[fs + t])
                            showMessage('Name already used, please change!');
                        else if (!idList[fs + ok[1]])
                            showMessage('You need to select an existing tieout state!');
                        else {
                            addId(t, folder, I_Timer, m[t] = {});
                            //                            addId(ok[1], folder + '.' + t, I_Timeout);
                            idList[folder + '.' + t][F_timeout] = ok[1];
                            return regen(folder + '.' + t);
                        }
                        setTimeout(doCreateTimer, 30, t, folder);
                    }
                }
            });
        }

        $(function () {
            pageInit(function () { // this is called when initialization happened and all objects are loaded!
                createFolderTree(true);
                //                createIdTree();
                if (main.adapterConfigIds.length > 1) {
                    var ah = '';
                    for (var ai of main.adapterConfigIds)
                        ah +=
                        ` <option value="${ai}" ${ah == '' ? ' selected' : ''}>${ai}</option>`;
                    $('#adapter-instances').html(ah).material_select().change(function () {
                        var i = $(this).val();
                    });
                } else $('.instance-config').hide();
                offOn($('#queue-all'), 'change', function () {
                    workTree.queueAll = this.checked;
                    checkConfig();
                }).prop('checked', !!workTree.queueAll);
                offOn($('#input-queue'), 'input', function () {
                    var n = $(this).val();
                    var ok = parseInt(n) >= 10 && parseInt(n) < 1000;
                    validateInput($(this));
                    if (ok) {
                        workTree.queueTime = parseInt(n);
                        checkConfig();
                    }
                }).val('' + (workTree.queueTime || 10));
                setDebug(main.states[main.currentId + debugLevel] ? parseInt(main.states[main.currentId +
                    debugLevel].val) : workTree.debugLevel);
            });
        });
    </script>
</head>

<body>
    <div id="stateMachine">
        <div class="row">
            <div class="col s2 m2 l1">
                <div class="valign-wrapper right">
                    <img src="/adapter/statemachine/statemachine.png" style="width: 2.5em; height: 2.5em" onclick="window.location.reload();">
                </div>
            </div>
            <div class="col s4 m4 l2">
                <h5>Statemachine Setup</h5>
            </div>
            <div class="col s2 m2 l1">
                <label class=" instance-config">Statemachine Instance to configure</label>
            </div>
            <div class="col s4 m4 l2">
                <select id="adapter-instances" class="instance-config">
                </select>
            </div>
            <div class="col s6 m6 l2">
                <h6>Control &amp; Options</h6>
            </div>
            <div class="col s3 m3 l2">
                <div class="switch left">
                    <label>Queue All Actions: Off
                        <input id="queue-all" type="checkbox">
                        <span class="lever"></span>On</label>
                </div>
            </div>
            <div class="col s2 m2 l1">
                <label for="input-queue" class="active">Queue Time in ms</label>
            </div>
            <div class="col s1 m1 l1">
                <input type="text" id="input-queue" minlength="2" maxlength="3" pattern="^\d+$" title="2 to 5 digit number">
            </div>
        </div>
        <div class="row">
            <div id="tab-events-content" class="col s12 m12 l6">
                <table id="tree" class="highlight bordered">
                    <thead>
                        <tr>
                            <th class="center" width="33%">Type</th>
                            <th class="center" width="33%">Id</th>
                            <th class="center" width="33%">Status</th>
                            </th>
                        </tr>
                    </thead>
                    <tbody id="table-data" class='scrollable'>
                    </tbody>
                </table>
            </div>
            <div class="col s12 m12 l6 table-interface">
                <div class="row">
                    <div class="col s1">
                        <div class="right valign-wrapper">
                            <label>Debug</label>&nbsp;
                        </div>
                    </div>
                    <div class="col s3">
                        <select id="debugLevel" class="browser-default">
                            <option value="" disabled selected>Choose your option</option>
                            <option value="0">Debug off</option>
                            <option value="1">Debug only errors &amp; warnings</option>
                            <option value="2">Debug state changes</option>
                            <option value="3">Debug all events</option>
                        </select>
                    </div>
                    <div class="col s2">
                        <button id="exportButton" class="waves-effect waves-light btn not-ok-cancel w100 btn-small">
                            <i class="material-icons left">file_upload</i>
                            <span>Export</span>
                    </div>
                    <div class="col s2">
                        <button id="importButton" class="waves-effect waves-light btn not-ok-cancel w100 btn-small">
                            <i class="material-icons left">file_download</i>
                            <span>Import</span>
                            <input type="file" id="fileJsonInput" name="fileInput" />
                        </button>
                    </div>
                    <div class="col s2">
                        <button id="saveButton" class="waves-effect waves-light btn not-ok-cancel w100 btn-small">
                            <i class="material-icons left">save</i>
                            <span>Save</span>
                        </button>
                    </div>
                    <div class="col s2">
                        <button id="reloadButton" class="waves-effect waves-light btn not-ok-cancel w100 btn-small">
                            <i class="material-icons left">loop</i>
                            <span>Reload</span>
                        </button>
                    </div>
                </div>
                <div class="divider clear10"></div>
                <div class="row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Folder"></i>
                        <label for="input-folder" class="active">Folder</label>
                        <a id="folder-add" title="Add Folder" class="btn-floating btn btn-small waves-effect waves-light teal right disabled">
                            <i class="material-icons">add</i>
                        </a>
                        <input type="text" id="input-folder" class="mach-val" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                    </div>
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Machine"></i>
                        <label for="input-machine" class="active">Machine</label>
                        <a id="machine-add" title="Add Machine" class="btn-floating btn btn-small waves-effect waves-light teal right disabled">
                            <i class="material-icons">add</i>
                        </a>
                        <input type="text" id="input-machine" class="mach-val" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                    </div>
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Event"></i>
                        <label for="input-event" class="active">Event</label>
                        <a id="event-add" title="Add Event" class="btn-floating btn btn-small waves-effect waves-light teal right  disabled">
                            <i class="material-icons">add</i>
                        </a>
                        <input type="text" id="input-event" class="mach-val" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                    </div>
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon=" Scene"></i>
                        <label for="input-scene" class="active">Scene</label>
                        <a id="scene-add" title="Add Scene" class="btn-floating btn btn-small waves-effect waves-light teal right disabled">
                            <i class="material-icons">add</i>
                        </a>
                        <input type="text" id="input-scene" class="mach-val" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                    </div>
                </div>
                <div class="divider clear15"></div>
                <div id="input-table-folder" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Folder"></i>
                        <input type="text" id="input-name-folder" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                        <label for="input-name-folder" class="active">Folder Name</label>
                    </div>
                    <div class="col s3">
                        <div class='right'>
                            <!--a id="input-add-machine" title="Add Machine" class="btn-floating btn waves-effect waves-light teal">
                                <i class="material-icons" my-icon="MachineAdd"></i>
                            </a>
                            <a id="input-add-event" title="Add Event" class="btn-floating btn waves-effect waves-light teal">
                                <i class="material-icons" my-icon="EventAdd"></i>
                            </a-->
                            <a id="input-rename-folder" title="Rename Folder" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                                <a title="Delete Folder" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                    <i class="material-icons" my-icon="Delete"></i>
                                </a>
                        </div>
                    </div>
                </div>
                <div id="input-table-scene" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon=" Scene"></i>
                        <input type="text" id="input-name-scene" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                        <label for="input-name-scene" class="active">Scene Name</label>
                    </div>
                    <div class="col s3">
                        <div class='right'>
                            <a id="input-rename-scene" title="Rename Scene" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a>
                            <a title="Delete Scene" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col s3">
                    </div>
                    <div class="col s3">
                        <label for="input-value-scene" class="active">Current Value: </label>
                        <span s-v="" class="input-value" id="input-value-scene"></span>
                    </div>
                </div>
                <div id="input-table-event" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Event"></i>
                        <input type="text" id="input-name-event" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                        <label for="input-name-event" class="active">Event Name</label>
                    </div>
                    <div class="col s3">
                        <div class='right'>
                            <a id="input-rename-event" title="Rename Event" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a>
                            <a title="Delete Event" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col s3">
                        <label for="input-function-event" class="active">Function</label>
                        <input type="text" id="input-function-event" class="input-function">
                    </div>
                    <div class="col s3">
                        <label for="input-value-event" class="active">Current Value: </label>
                        <span s-v="" class="input-value" id="input-value-event"></span>
                    </div>
                </div>
                <div id="input-table-machine" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Machine"></i>
                        <input type="text" id="input-name-machine" minlength="3" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                        <label for="input-name-machine" class="active">Machine Name</label>
                    </div>
                    <div class="input-field col s3">
                        <div class='right'>
                            <a id="input-add-state" title="Add State" class="btn-floating btn btn-small waves-effect waves-light teal">
                                <i class="material-icons" my-icon="StateAdd"></i>
                            </a>
                            <a id="input-add-timer" title="Add Timer" class="btn-floating btn btn-small waves-effect waves-light teal">
                                <i class="material-icons" my-icon="Timer"></i>
                            </a>
                            <a title="Add Autolink" class="btn-floating btn btn-small waves-effect waves-light teal input-add-link">
                                <i class="material-icons" my-icon="LinkAuto"></i>
                            </a>
                            <a id="input-rename-machine" title="Rename Machine" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a>
                            <a title="Delete Machine" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="StateAdd"></i>
                        <select id="input-machine-states" class "select-input-states">
                            <option value="" selected>Undefined</option>
                        </select>
                        <label>Default State</label>
                    </div>
                    <div class="col s3">
                        <label for="input-value-machine" class="active">Current State: </label>
                        <span s-v="" class="input-value" id="input-value-machine"></span>
                    </div>
                </div>
                <div id="input-table-state" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="State"></i>
                        <input type="text" id="input-name-state" minlength="2" maxlength="20" pattern="^[$_A-Za-z][\-$\w]+$" title="Start with leetter and follow with letter|number|$|-|_">
                        <label for="input-name-state" class="active">State</label>
                    </div>
                    <div class="col s3">
                        <div class='right'>
                            <a title="Add Link" class="btn-floating btn btn-small waves-effect waves-light teal input-add-link">
                                <i class="material-icons" my-icon="Link"></i>
                            </a>
                            <a title="Rename State" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a>
                            <a title="Delete State" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                </div>
                <div id="input-table-timer" class="input-table row">
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Timer"></i>
                        <input type="text" id="input-name-timer" minlength="2" maxlength="20" pattern="^(\d+w\s*)?(\d+d\s*)?(\d+h\s*)?(\d+m(?!s)\s*)?(\d+)?(m?s)?\s*$"
                            title="Start with number and then (w,d,h,m,s,ms)">
                        <label for="input-name-timer" class="active">State</label>
                    </div>
                    <div class="col s3">
                        <div class='right'>
                            <a title="Add Link" class="btn-floating btn btn-small waves-effect waves-light teal input-add-link">
                                <i class="material-icons" my-icon="Link"></i>
                            </a>
                            <a title="Change Timer" class="input-rename btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a>
                            <a title="Delete Timer" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                    <div class="input-field col s3">
                        <i class="material-icons prefix" my-icon="Timeout"></i>
                        <select id="input-timeout-state" class "select-input-states">
                            <option value="" disabled selected>select timeout</option>
                        </select>
                        <label for="input-timeout-state">Timeout State</label>
                    </div>
                </div>
                <div id="input-table-link" class="input-table row">
                    <div id="input-link-state" class="input-field col s3">
                        <i id="input-link-icon" class="material-icons prefix" my-icon="Link"></i>
                        <select id="input-tostate-link" class "select-input-states">
                            <option value="" disabled selected>select timeout</option>
                        </select>
                        <label id="input-link-from">from</label>
                    </div>
                    <div class="col s3">
                        <div class='right'>
                            <!--a id="input-rename-link" title="Save Change" class="btn-floating btn btn-small waves-effect waves-light blue disabled">
                                <i class="material-icons" my-icon="Rename"></i>
                            </a-->
                            <a title="Delete State" class="input-remove btn-floating btn btn-small waves-effect waves-light red">
                                <i class="material-icons" my-icon="Delete"></i>
                            </a>
                        </div>
                    </div>
                    <div class="col s3">
                        <label for="input-function-link" class="active">Function</label>
                        <input type="text" id="input-function-link">
                    </div>
                </div>
                <div id="input-event-data" class="input-table row">
                    <div class "col s12">
                        <i class="material-icons data-icon prefix" my-icon="Event"></i>
                        <a class="btn-floating btn btn-small right waves-effect waves-light teal show-help">
                            <i class="material-icons show-help" my-icon="help">help_outline</i>
                        </a>
                        <a class="btn-floating btn btn-small right waves-effect waves-light blue chips-move chips-right">
                            <i class="material-icons">chevron_right</i>
                        </a>
                        <a class="btn-floating btn btn-small right waves-effect waves-light blue chips-move chips-left">
                            <i class="material-icons">chevron_left</i>
                        </a>
                        <label class='data-title'>Event list, current id: </label>
                        <span class="input-text"></span>
                        <div class="chips"></div>
                    </div>
                </div>
                <div id="input-event-help" class="input-table input-table-help row">
                    <div class "col s12">
                        <ul class="collapsible popout" data-collapsible="accordion">
                            <li>
                                <div class="collapsible-header">
                                    <img class="help" src="lib/img/timer-icon-timelapse.png"> every:
                                    <code>[#w][#d][#h][#m][#][s]</code>, # denotes any or multiple number(s) (0-9), at least one group of numbers must be present!</div>
                                <div class="collapsible-body">
                                    Examples:
                                    <code>100</code> or
                                    <code>100s</code> => every 100 seconds,
                                    <code>10m</code> => 10 minutes,
                                    <code>2h30m</code> => every 2 hours and 30 minutes
                                </div>
                            </li>
                            <li>
                                <div class="collapsible-header">
                                    <img class="help" src="lib/img/schedule_24h.png"> at:
                                    <code>[*|*/#|#]:*|#|*/#[:*|#|*/#]</code> denotes hours:minutes[:seconds] with either
                                    <code>*</code> = any,
                                    <code>0-9+</code> = at or
                                    <code>*/0-9+</code> = every (x), 24h only!</div>
                                <div class="collapsible-body">
                                    Examples:
                                    <br>
                                    <code>12:12</code> => every day at 12:12
                                    <br>
                                    <code>*:*:5</code> => at the 5th second every minute/hour
                                    <br>
                                    <code>*:*/2</code> => every two minutes #2
                                </div>
                            </li>
                            <li>
                                <div class="collapsible-header">
                                    <img class="help" src="lib/img/timer-icon-schedule.png"> schedule:
                                    <code>[*|#|#-#|*/#|#-#/#] *|#|#-#|*/#|#-#/#{5 times}</code> denotes [seconds] minutes hours day/month month day/week
                                </div>
                                <div class="collapsible-body">
                                    <code>*</code> = any,
                                    <code>0-9+</code> = #, at or
                                    <code>*/0-9+</code> = every
                                    <code>#a-#b/#x</code> = every x within a and b (do not write a/b/x) 
                                    the first part for seconds is optional<br>
                                    Examples:
                                    <br>
                                    <code>0 6 * * 2-6</code> => @ 06:00 on every 2nd to 6th day of the week
                                    <br>
                                    <code>*/2 * * * *</code> => every second (even) minute of the day
                                    <code>1-59/2 * * * *</code> => every second (odd) minute of the day
                                    <br>
                                    <code>10 22 1 * * </code> => @22:10 on every 1st day of the month
                                    <code>10 22 * 1 * </code> => @22:10 on every 1st day of the week
                                </div>
                            </li>
                            <li>
                                <div class="collapsible-header">
                                    <img class="help" src="lib/img/astro.png"> at astro time:
                                    <code>@astroname[+-#]</code> denotes astrotime <code>[+|-0-9+]</code> = minutes after or before this event</div>
                                <div class="collapsible-body">
                                    Astrotimes are <code>sunrise, solarNoon, sunset, sunriseEnd, sunsetStart, dawn, dusk, nauticalDawn, nauticalDusk, nadir, nightEnd, night, goldenHourEnd, goldenHour</code>
                                    Examples:
                                    <br>
                                    <code>@sunrise</code> => every day at sunrise, 
                                    <code>@sunset+20</code> => every day 20 min after sunset and
                                    <code>@nadir-120</code> => every day two hours before astrological midnight (darkest time)
                                </div>
                            </li>
                            <li>
                                <div class="collapsible-header">
                                        <img class="help" src="lib/img/flash.png"> id/name/Regexp: <code>[/]a-9.*+[/][&amp;|?|!][~][+|-|=|!=|>|>=|&lt;|&lt;=|?|^|$|#]</code></div>
                                <div class="collapsible-body">
                                    The first part is the name (if this is the only id having this name)  or an id. It can be also a regexp <coode>/.*/[i]</coode> or can include <code>*</code> which will be translater to regexp with <code.*/code> where the * was.<br>
                                    After that is optional the ack code <code>&amp;</code> only with ack, <code>!</code> only without ack or <code>?</code> or nonexistant with any ack.<br> 
                                    Thereafter can be the onchange flag <code>~</code>, if it exist the event fires only if value or ack was changed<br>
                                    After that is either <code>+</code> for if value is true (or !=0) or <code>-</code> for a false (or ==0) value<br>
                                    Instead of that there can be also comparisons like <code>=, !=, >, >=, &lt;, &lt;=</code> where the value is either the last value (if empty) or a string after the comparison operator.
                                    Other operators are also available like <code>?</code> for includes or <code>#</code> for does not include<br>
                                    as well as  <code>^</code> for starts with or <code>$</code> for ends with<br>
                                    Examples:
                                    <br> <code>BewegungsmelderEingang.BRIGHTNESS>10</code> => would fire on every change of the value bigger than 10
                                    <br> <code>Timer.test!+</code> => would fire if Timer.test would go to true with no ack
                                    <br> <code>Timer.test&amp;~</code> => would fire if Timer.test would would change with ack
                                    <br> <code>Timer.test>=</code> => would fire if the new value of Timer.test >= the old value
                                    <br> <code>Timer.test^No</code> => would fire if Timer.test will start with 'No'
                                    <br> <code>*.LOWBAT+</code> => would fire if any id with '.LOWBAT' at the end would go true
                                    <br> <code>/^radar\.0\.\w+\.here$/-</code> => would fire if any id of 'radar.0.*.here' would go to false
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="input-action-data" class="input-table row">
                    <div class "col s12">
                        <i class="material-icons data-icon prefix" my-icon="directions_run">directions_run</i>
                        <a class="btn-floating btn btn-small right waves-effect waves-light teal show-help">
                            <i class="material-icons" my-icon="help">help_outline</i>
                        </a>
                        <a class="btn-floating btn btn-small right waves-effect waves-light blue chips-move chips-right">
                            <i class="material-icons">chevron_right</i>
                        </a>
                        <a class="btn-floating btn btn-small right waves-effect waves-light blue chips-move chips-left">
                            <i class="material-icons">chevron_left</i>
                        </a>
                        <label class='data-title'>Action list, current id: </label>
                        <span class="input-text"></span>
                        <div class="chips"></div>
                    </div>
                </div>
                <div id="input-action-data1" class="input-table row">
                    <div class "col s12">
                        <i class="material-icons data-icon prefix" my-icon="directions_run">directions_run</i>
                        <a class="btn-floating btn btn-small right waves-effect waves-light teal show-help">
                            <i class="material-icons" my-icon="help">help_outline</i>
                        </a>
                        <a class="btn-floating btn btn-small right waves-effect waves-light blue chips-move chips-right">
                            <i class="material-icons">chevron_right</i>
                        </a>
                        <a class="btn-floating btn btn-small right waves-effect waves-light blue chips-move chips-left">
                            <i class="material-icons">chevron_left</i>
                        </a>
                        <label class='data-title'>Action list, current id: </label>
                        <span class="input-text"></span>
                        <div class="chips"></div>
                    </div>
                </div>
                <div id="input-action-help" class="input-table input-table-help row">
                    <div class "col s12">
                        <h6>Help on Actions: [] = optional, + = one or more, 1-9+ = # = numbers, a-Z letters, a-9 = numbers or letters,
                            * = all or '-' or '_'</h6>
                        <ul class="collapsible popout" data-collapsible="accordion">
                            <li>
                                <div class="collapsible-header">
                                        <img class="help" src="lib/img/hourglass.png"> delay: <code>[#m][#s][#][ms]</code> at least one number group must exist!
                                    be present!</div>
                                <div class="collapsible-body">
                                    Examples:
                                    <code>100</code> or
                                    <code>100ms</code> => 100ms,
                                    <code>10s</code> => 10 seconds,
                                    <code>1m30s</code> => 1 monute 30 seconds
                                </div>
                            </li>
                            <li>
                                <div class="collapsible-header">
                                        <img class="help" src="lib/img/exe.png"> command: $ * with @0-9 for args, @a-9+ for states or @(*) for eval</div>
                                <div class="collapsible-body">
                                    Examples:
                                    <br>
                                    <code>$ iobroker backup $ echo @(@0 ? 1 : 0) > /sys/class/leds/green_led/brightness</code>
                                    => would switch on the green led on/off an orange-pi, use led0 for a raspi
                                    <br>
                                    <code>$ echo @folder.state > wherever</code> => would echo the value of folder.state
                                    <br>
                                    <code>$ echo @0,@1,@2</code> => would echo the new value of the event, and the inpit values
                                    #1 and #2
                                </div>
                            </li>
                            <li>
                                <div class="collapsible-header">
                                        <img class="help" src="lib/img/js.png"> eval: (*) with @0-9 for args or @a-9+ for states</div>
                                <div class="collapsible-body">
                                    Examples:
                                    <br>
                                    <code>(@0 ? 1 : 0)</code> => return 1 if value is true and 0 if not
                                    <br>
                                    <code>(Math.round( (@1 + @2 + @3)/3))</code> => would calculate the average of 3 input values
                                    <br>
                                    <code>(!@folder.state)</code> => would return the boolean inverse of folder.state
                                </div>
                            </li>
                            <li>
                                <div class="collapsible-header">
                                        <img class="help" src="lib/img/run.png"> id/name: a-9+[&amp;][!][/][~|=+|=-|=!|=?|= value or (*)]</div>
                                <div class="collapsible-body">
                                    <code>&amp;</code>: queues the output with queue time (must be first) and
                                    <br>
                                    <code>!</code>: sets ack (default no Ack) can be after the id as a modifier.
                                    <br>
                                    <code>/</code>: sets always (default only on change) can be after the id (and &amp; or !) as
                                    a modifier.
                                    <br>
                                    <code>~</code>: toggle state (true/false),
                                    <code>=+, =-</code>: set output to true(+) or false(-),
                                    <br>
                                    <code>=? , =!</code>: set the output to the new event value (=?) or to the negated event value
                                    (=!)
                                    <br>
                                    <code>=value , =(eval text)</code>: set the output to the value or to en evaluated value
                                    <br> Examples:
                                    <br> BewegungsmelderEingang.BRIGHTNESS => would set this state to the new value of the event
                                    <br>
                                    <code>GPIO.7=(@0>20)</code> => would set the state GPIO.7 to true if the event has a value
                                    greater than 20
                                    <br>
                                    <code>GPIO.7~</code> => would toggle GPIO.7
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col s6 no-padding">
                <h6>Machine/event/scene views
                    <a id="vis-fit" title="Fit data">&nbsp;
                        <i class="tiny material-icons">settings_overscan</i>&nbsp;</a>
                    <a id="vis-delete" title="Empty Log to last entry">&nbsp;
                        <i class="tiny material-icons">delete_forever</i>&nbsp;</a>
                    <a id="vis-delete-all" title="Delete all log entries">&nbsp;
                        <i class="tiny material-icons">delete</i>&nbsp;</a>
                </h6>
                <div id="event-span">
                    <div id="mynetwork"></div>
                </div>
            </div>
            <div class="col s6">
                <h6>Debug log (newest on bottom)
                    <a id="script-down" title="Scroll to end">&nbsp;
                        <i class="tiny material-icons">file_download</i>&nbsp;</a>
                    <a id="script-delete" title="Empty Log">&nbsp;
                        <i class="tiny material-icons">delete</i>&nbsp;</a>
                </h6>
                <div id='log-data' style="overflow-x: auto; overflow-y: auto" comment="; width: calc(100% - 30px)">
                    <table style="width: 100%">
                        <thead>
                            <th width="85px">Time</th>
                            <th width="50px">Severity</th>
                            <th width="*">Message</th>
                        </thead>
                        <tbody id="script-output"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div id="dialog-modal" class="modal">
        <div class="modal-content">
            <div class="row">
                <div class="col s2">
                    <i id="modalIcon" class="material-icons large" my-icon="Folder">check</i>
                </div>
                <div id="modalText" class="col s10">
                    <h4>Title</h4>
                    <p>text</p>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="modalOk" class="modal-action modal-close waves-effect waves-light btn" type="submit">
                <i class="material-icons left">check</i>
                <span>OK</span>
            </button>
            <button id="modalExit" class="modal-action modal-close waves-effect waves-light btn brown">
                <i class="material-icons left">close</i>
                <span>cancel</span>
            </button>
        </div>
    </div>
    <div id="id-modal" class="modal">
        <div class="modal-content">
            <div class="row">
                <div class="col s12">
                    <table id="tree-id" class='highlight bordered responsive-table'>
                        <thead>
                            <tr>
                                <th class="center" width="30%">id</th>
                                <th class="center" width="20%">name</th>
                                <th class="center" width="10%">type</th>
                                <th class="center" width="10%">role</th>
                                <th class="center" width="20%">value</th>
                            </tr>
                        </thead>
                        <tbody id="table-id-data" class='scrollable' height="30vh">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button id="modalIdOk" class="modal-action modal-close waves-effect waves-light btn" type="submit">
                <i class="material-icons left">check</i>
                <span>OK</span>
            </button>
            <button id="modalIdExit" class="modal-action modal-close waves-effect waves-light btn brown">
                <i class="material-icons left">close</i>
                <span>cancel</span>
            </button>
        </div>
    </div>
    <div id="input-modal" class="modal">
        <div class="modal-content">
            <div class="row">
                <div class="row">
                    <div class="row">
                        <h4>
                            <span id="input-modal-title">Title</span>
                        </h4>
                        <p>
                            <span id="input-modal-text">Text</span>
                        </p>
                    </div>
                    <div id="input-modal-inputs"></div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat" type="submit" id="input-modal-button">OK</a>
            <a href="#" class="modal-close waves-effect waves-green btn-flat " id="input-modal-cancel">Cancel</a>
        </div>
    </div>


</body>

</html>